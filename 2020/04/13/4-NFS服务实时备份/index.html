<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>4.NFS服务实时备份 | WF's Blog</title><meta name="description" content="4.NFS服务实时备份"><meta name="keywords" content="nfs,backup,lsyncd"><meta name="author" content="Wu Fei"><meta name="copyright" content="Wu Fei"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://hm.baidu.com"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="4.NFS服务实时备份"><meta name="twitter:description" content="4.NFS服务实时备份"><meta name="twitter:image" content="http://linuxwf.com/img/63199486_p0.jpg"><meta property="og:type" content="article"><meta property="og:title" content="4.NFS服务实时备份"><meta property="og:url" content="http://linuxwf.com/2020/04/13/4-NFS%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%97%B6%E5%A4%87%E4%BB%BD/"><meta property="og:site_name" content="WF's Blog"><meta property="og:description" content="4.NFS服务实时备份"><meta property="og:image" content="http://linuxwf.com/img/63199486_p0.jpg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="http://linuxwf.com/2020/04/13/4-NFS%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%97%B6%E5%A4%87%E4%BB%BD/"><link rel="prev" title="5.SSH服务" href="http://linuxwf.com/2020/04/13/5-SSH%E6%9C%8D%E5%8A%A1/"><link rel="next" title="3.NFS文件系统" href="http://linuxwf.com/2020/04/13/3-NFS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?bf8fa809dbe0a82b3d983accb9d256fe";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"GQXJKQPX6A","apiKey":"9d6901decfc3e9736a8f99965d4fc700","indexName":"my_blog","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: true,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="WF's Blog" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">29</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">19</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">6</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 娱乐</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/video/"><i class="fa-fw fa fa-video"></i><span> 视频</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw far fa-images"></i><span> 照片</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fa fa-book"></i><span> 书籍</span></a></li><li><a class="site-page" href="/games/"><i class="fa-fw fa fa-gamepad"></i><span> Game</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#NFS服务实时备份"><span class="toc-number">1.</span> <span class="toc-text">NFS服务实时备份</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#第一章-NFS单点问题"><span class="toc-number">1.1.</span> <span class="toc-text">第一章 NFS单点问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-为什么需要解决NFS单点问题"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.为什么需要解决NFS单点问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-解决思路"><span class="toc-number">1.1.2.</span> <span class="toc-text">2. 解决思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-需要用到的软件"><span class="toc-number">1.1.3.</span> <span class="toc-text">3. 需要用到的软件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-环境准备"><span class="toc-number">1.1.4.</span> <span class="toc-text">4. 环境准备</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第二章-Inotify简介"><span class="toc-number">1.2.</span> <span class="toc-text">第二章 Inotify简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-查看系统内核"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 查看系统内核</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-安装Inotify"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 安装Inotify</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-关键参数说明"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 关键参数说明:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-inotifywait详细参数"><span class="toc-number">1.2.4.</span> <span class="toc-text">2.4 inotifywait详细参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-参数说明"><span class="toc-number">1.2.5.</span> <span class="toc-text">2.5 参数说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-查看inotify默认参数"><span class="toc-number">1.2.6.</span> <span class="toc-text">2.6 查看inotify默认参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-测试"><span class="toc-number">1.2.7.</span> <span class="toc-text">2.7 测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-8-inotify优缺点"><span class="toc-number">1.2.8.</span> <span class="toc-text">2.8 inotify优缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第三章sersync安装部署"><span class="toc-number">1.3.</span> <span class="toc-text">第三章sersync安装部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-下载sersync"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 下载sersync</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-解压"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 解压</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3修改配置文件"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3修改配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-查看帮助说明"><span class="toc-number">1.3.4.</span> <span class="toc-text">3.4 查看帮助说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-启动服务"><span class="toc-number">1.3.5.</span> <span class="toc-text">3.5 启动服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-测试数据同步传输"><span class="toc-number">1.3.6.</span> <span class="toc-text">3.6 测试数据同步传输</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第四章-lsyncd-服务"><span class="toc-number">1.4.</span> <span class="toc-text">第四章 lsyncd 服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-安装lsyncd"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 安装lsyncd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-创建配置文件"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 创建配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-配置文件说明"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3 配置文件说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-启动服务"><span class="toc-number">1.4.4.</span> <span class="toc-text">4.4 启动服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-查看日志"><span class="toc-number">1.4.5.</span> <span class="toc-text">4.5 查看日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-测试数据"><span class="toc-number">1.4.6.</span> <span class="toc-text">4.6 测试数据</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(/img/63199486_p0.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">WF's Blog</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 娱乐</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/video/"><i class="fa-fw fa fa-video"></i><span> 视频</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw far fa-images"></i><span> 照片</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fa fa-book"></i><span> 书籍</span></a></li><li><a class="site-page" href="/games/"><i class="fa-fw fa fa-gamepad"></i><span> Game</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">4.NFS服务实时备份</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-04-13 12:14:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-04-13</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-04-13 12:23:03"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-04-13</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/LNMP/">LNMP</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon far fa-file-word" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">3.8k</span><span class="post-meta__separator">|</span><i class="post-meta__icon far fa-clock" aria-hidden="true"></i><span>阅读时长: 16 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon far fa-comments" aria-hidden="true"></i><span>评论数:</span><a href="/2020/04/13/4-NFS%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%97%B6%E5%A4%87%E4%BB%BD/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2020/04/13/4-NFS%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%97%B6%E5%A4%87%E4%BB%BD/" itemprop="commentCount"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h1 id="NFS服务实时备份"><a href="#NFS服务实时备份" class="headerlink" title="NFS服务实时备份"></a>NFS服务实时备份</h1><h2 id="第一章-NFS单点问题"><a href="#第一章-NFS单点问题" class="headerlink" title="第一章 NFS单点问题"></a>第一章 NFS单点问题</h2><h3 id="1-为什么需要解决NFS单点问题"><a href="#1-为什么需要解决NFS单点问题" class="headerlink" title="1.为什么需要解决NFS单点问题"></a>1.为什么需要解决NFS单点问题</h3><p>只有一个NFS服务器时，当出现故障时，数据没办法再实现共享，既不安全也不稳定</p>
<h3 id="2-解决思路"><a href="#2-解决思路" class="headerlink" title="2. 解决思路"></a>2. 解决思路</h3><p>1).监控文件是否发生变化</p>
<p>2)如果发生变化,就通过rsync传输到备份服务器,并且数据保持完全一致</p>
<p>3)备份服务器也需要提供NFS服务,以便NFS服务器故障的时候可以顶替,继续提供NFS服务</p>
<p>4)假如发生了故障,客户端需要先卸载原有已经挂载的目录,然后重新挂载到备份服务器的NFS共享目录</p>
<h3 id="3-需要用到的软件"><a href="#3-需要用到的软件" class="headerlink" title="3. 需要用到的软件"></a>3. 需要用到的软件</h3><p>1).监控文件是否发生变化    inotify-tools</p>
<p>2).实时备份  rsync+inotify-tools / sersync / lsyncd</p>
<p>3).提供NFS服务  NFS+RPC</p>
<h3 id="4-环境准备"><a href="#4-环境准备" class="headerlink" title="4. 环境准备"></a>4. 环境准备</h3><table>
<thead>
<tr>
<th>操作系统</th>
<th>服务器角色</th>
<th>IP地址</th>
</tr>
</thead>
<tbody><tr>
<td>CentOS  7.4 x86_64</td>
<td>NFS服务端（nfs-server）</td>
<td>172.16.1.31</td>
</tr>
<tr>
<td>CentOS  7.4 x86_64</td>
<td>NFS备份服务器（backup-server）</td>
<td>172.16.1.41</td>
</tr>
</tbody></table>
<h2 id="第二章-Inotify简介"><a href="#第二章-Inotify简介" class="headerlink" title="第二章 Inotify简介"></a>第二章 Inotify简介</h2><p>Inotify是一种强大的,细粒度的,异步的文件系统事件监视机制,Linux2.6.13起加入了inotify支持,通过inotify可以监控文件系统中添加,删除,修改,移动等各种事件,利用这个内核接口,第三方软件就可以监控文件系统下文件的各种变化情况,而inotify-tools正是实施这样监控的软件,另外一个这样效果的软件是中国人周洋在金山公司开发的sersync,还有一个配置更简单的软件叫lsyncd</p>
<h3 id="2-1-查看系统内核"><a href="#2-1-查看系统内核" class="headerlink" title="2.1 查看系统内核"></a>2.1 查看系统内核</h3><p>查看当前系统内核是否支持inotify</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs ~]<span class="comment"># uname -r</span></span><br><span class="line">3.10.0-693.el7.x86_64</span><br></pre></td></tr></table></figure>

<h3 id="2-2-安装Inotify"><a href="#2-2-安装Inotify" class="headerlink" title="2.2 安装Inotify"></a>2.2 安装Inotify</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs ~]<span class="comment"># yum search inotify  #查找inotify包名</span></span><br><span class="line">[root@nfs ~]<span class="comment"># yum -y install inotify-tools</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-关键参数说明"><a href="#2-3-关键参数说明" class="headerlink" title="2.3 关键参数说明:"></a>2.3 关键参数说明:</h3><p>1)在/proc/sys/fs/inotify目录下有三个文件,对inotify机制有一定限制</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs ~]<span class="comment"># ls -l /proc/sys/fs/inotify/</span></span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 19 11:37 max_queued_events</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 19 09:52 max_user_instances</span><br><span class="line">-rw-r--r-- 1 root root 0 Jul 19 11:37 max_user_watches</span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line">max_queued_events   =====&gt;设置inotify设置inotify实例事件(event)队列可容纳的事件数量</span><br><span class="line">max_user_instances  =====&gt;设置每个用户可以运行的inotify或者inotifywatch命令的进程数</span><br><span class="line">max_user_watches    =====&gt;设置inotifywait或者inotifywatch命令可以监视的文件数量(单进程)</span><br></pre></td></tr></table></figure>

<h3 id="2-4-inotifywait详细参数"><a href="#2-4-inotifywait详细参数" class="headerlink" title="2.4 inotifywait详细参数"></a>2.4 inotifywait详细参数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs ~]<span class="comment"># inotifywait --help</span></span><br><span class="line">inotifywait 3.14</span><br><span class="line">Wait <span class="keyword">for</span> a particular event on a file or <span class="built_in">set</span> of files.</span><br><span class="line">Usage: inotifywait [ options ] file1 [ file2 ] [ file3 ] [ ... ]</span><br><span class="line">Options:</span><br><span class="line">    -h|--<span class="built_in">help</span>       Show this <span class="built_in">help</span> text.</span><br><span class="line">    @&lt;file&gt;         Exclude the specified file from being watched.</span><br><span class="line">    --exclude &lt;pattern&gt;</span><br><span class="line">                    Exclude all events on files matching the</span><br><span class="line">                    extended regular expression &lt;pattern&gt;.</span><br><span class="line">    --excludei &lt;pattern&gt;</span><br><span class="line">                    Like --exclude but <span class="keyword">case</span> insensitive.</span><br><span class="line">                    <span class="comment">###排除文件或目录,不区分大小写</span></span><br><span class="line">    -m|--monitor    Keep listening <span class="keyword">for</span> events forever.  Without</span><br><span class="line">                    this option, inotifywait will <span class="built_in">exit</span> after one</span><br><span class="line">                    event is received.</span><br><span class="line">    -d|--daemon     Same as --monitor, except run <span class="keyword">in</span> the background</span><br><span class="line">                    logging events to a file specified by --outfile.</span><br><span class="line">                    Implies --syslog.</span><br><span class="line">    -r|--recursive  Watch directories recursively. </span><br><span class="line">    <span class="comment">###递归查询目录</span></span><br><span class="line">    --fromfile &lt;file&gt;</span><br><span class="line">                    Read files to watch from &lt;file&gt; or `-<span class="string">' for stdin.</span></span><br><span class="line"><span class="string">    -o|--outfile &lt;file&gt;</span></span><br><span class="line"><span class="string">                    Print events to &lt;file&gt; rather than stdout.</span></span><br><span class="line"><span class="string">    -s|--syslog     Send errors to syslog rather than stderr.</span></span><br><span class="line"><span class="string">    -q|--quiet      Print less (only print events). </span></span><br><span class="line"><span class="string">    ###打印很少的信息,仅仅打印监控事件的信息,安静的</span></span><br><span class="line"><span class="string">    -qq             Print nothing (not even events).</span></span><br><span class="line"><span class="string">    --format &lt;fmt&gt;  Print using a specified printf-like format ###打印指定输出类似格式字符串</span></span><br><span class="line"><span class="string">                    string; read the man page for more details.</span></span><br><span class="line"><span class="string">    --timefmt &lt;fmt&gt; strftime-compatible format string for use with</span></span><br><span class="line"><span class="string">                    %T in --format string.  ###指定时间输出的格式</span></span><br><span class="line"><span class="string">    -c|--csv        Print events in CSV format.</span></span><br><span class="line"><span class="string">    -t|--timeout &lt;seconds&gt;</span></span><br><span class="line"><span class="string">                    When listening for a single event, time out after</span></span><br><span class="line"><span class="string">                    waiting for an event for &lt;seconds&gt; seconds.</span></span><br><span class="line"><span class="string">                    If &lt;seconds&gt; is 0, inotifywait will never time out.</span></span><br><span class="line"><span class="string">    -e|--event &lt;event1&gt; [ -e|--event &lt;event2&gt; ... ]</span></span><br><span class="line"><span class="string">        Listen for specific event(s).  If omitted, all events are </span></span><br><span class="line"><span class="string">        listened for. ###通过次参数可以指定需要监控的事件</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Exit status:</span></span><br><span class="line"><span class="string">    0  -  An event you asked to watch for was received.</span></span><br><span class="line"><span class="string">    1  -  An event you did not ask to watch for was received</span></span><br><span class="line"><span class="string">          (usually delete_self or unmount), or some error occurred.</span></span><br><span class="line"><span class="string">    2  -  The --timeout option was given and no events occurred</span></span><br><span class="line"><span class="string">          in the specified interval of time.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Events:</span></span><br><span class="line"><span class="string">    access      file or directory contents were read </span></span><br><span class="line"><span class="string">    ###文件或目录被读取</span></span><br><span class="line"><span class="string">    modify      file or directory contents were written </span></span><br><span class="line"><span class="string">    ###文件或目录被修改</span></span><br><span class="line"><span class="string">    attrib      file or directory attributes changed </span></span><br><span class="line"><span class="string">    ###文件或目录属性被改变</span></span><br><span class="line"><span class="string">    close_write file or directory closed, after being opened in </span></span><br><span class="line"><span class="string">                writeable mode ###文件或目录封闭,无论读/写模式</span></span><br><span class="line"><span class="string">    close_nowrite   file or directory closed, after being opened in</span></span><br><span class="line"><span class="string">                read-only mode</span></span><br><span class="line"><span class="string">    close       file or directory closed, regardless of read/write mode</span></span><br><span class="line"><span class="string">    open        file or directory opened ###文件目录被打开</span></span><br><span class="line"><span class="string">    moved_to    file or directory moved to watched directory ###文件或目录被移动到另一个目录</span></span><br><span class="line"><span class="string">    moved_from  file or directory moved from watched directory</span></span><br><span class="line"><span class="string">    move        file or directory moved to or from watched directory</span></span><br><span class="line"><span class="string">    create      file or directory created within watched directory ###文件或目录被创建在当前目录</span></span><br><span class="line"><span class="string">    delete      file or directory deleted within watched directory ###文件或目录被删除</span></span><br><span class="line"><span class="string">    delete_self file or directory was deleted</span></span><br><span class="line"><span class="string">    unmount     file system containing file or directory unmounted ###文件系统被卸载</span></span><br></pre></td></tr></table></figure>

<h3 id="2-5-参数说明"><a href="#2-5-参数说明" class="headerlink" title="2.5 参数说明"></a>2.5 参数说明</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">inotifywait参数说明</span><br><span class="line">参数名称            参数说明</span><br><span class="line">-m ,-monitor       始终保持事件监听状态</span><br><span class="line">-r,-recursive      递归查询目录</span><br><span class="line">-q,-quiet          只打印监控事件的信息</span><br><span class="line">-exclude           排除文件或目录时,不区分大小写</span><br><span class="line">-t,-timeout        超时时间</span><br><span class="line">-timefmt           指定时间输出格式</span><br><span class="line">-format            指定时间输出格式</span><br><span class="line">-e,event           后面指定增,删,改等事件</span><br><span class="line">inotifywait events 事件说明</span><br><span class="line">access             读取文件或目录内容</span><br><span class="line">modify             修改文件或目录内容</span><br><span class="line">attrib             文件或目录的属性改变</span><br><span class="line">close_write        修改真实文件内容</span><br><span class="line">close_nowrite   </span><br><span class="line">close   </span><br><span class="line">open               文件或目录被打开</span><br><span class="line">moved_to           文件或目录移动到</span><br><span class="line">moved_from         文件或目录从...移动到</span><br><span class="line">move               移动文件或目录移动到监视目录</span><br><span class="line">create             在监视目录下创建文件或目录</span><br><span class="line">delete             删除监视目录下的文件或目录</span><br><span class="line">delete_self </span><br><span class="line">umount             卸载文件系统</span><br></pre></td></tr></table></figure>

<h3 id="2-6-查看inotify默认参数"><a href="#2-6-查看inotify默认参数" class="headerlink" title="2.6 查看inotify默认参数"></a>2.6 查看inotify默认参数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs ~]<span class="comment"># sysctl -a|grep max_queued_events</span></span><br><span class="line">fs.inotify.max_queued_events = 327679</span><br><span class="line">[root@nfs ~]<span class="comment"># sysctl -a |egrep max_user_watches</span></span><br><span class="line">fs.epoll.max_user_watches = 412098</span><br><span class="line">fs.inotify.max_user_watches = 50000000</span><br><span class="line">[root@nfs ~]<span class="comment"># sysctl -a |egrep max_user_instances</span></span><br><span class="line">fs.inotify.max_user_instances = 128</span><br></pre></td></tr></table></figure>

<h3 id="2-7-测试"><a href="#2-7-测试" class="headerlink" title="2.7 测试"></a>2.7 测试</h3><p>测试inotify-tools监控文件发生变化</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">inotifywait -mrq --timefmt <span class="string">'%d/%m/%y %H:%M'</span> --format <span class="string">'%T %w%f'</span> -e delete,create /backup</span><br><span class="line">inotifywait -mrq --timefmt <span class="string">'%d/%m/%y %H:%M'</span> --format <span class="string">'%T %w%f'</span> -e close_write /backup</span><br></pre></td></tr></table></figure>

<p>监控脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat inotify_push.sh </span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">Path=/data</span><br><span class="line">backup_Server=172.16.1.41</span><br><span class="line"><span class="built_in">export</span> RSYNC_PASSWORD=oldboy</span><br><span class="line"></span><br><span class="line">/usr/bin/inotifywait -mrq --format <span class="string">'%w%f'</span> -e create,close_write,delete /data | <span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;line&#125;</span>"</span></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="variable">$line</span> ];<span class="keyword">then</span></span><br><span class="line">    rsync -azvP <span class="variable">$line</span> --delete rsync_backup@<span class="variable">$backup_Server</span>::data</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$Path</span> &amp;&amp;\</span><br><span class="line">    rsync -azvP ./ --delete rsync_backup@<span class="variable">$backup_Server</span>::data</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="2-8-inotify优缺点"><a href="#2-8-inotify优缺点" class="headerlink" title="2.8 inotify优缺点"></a>2.8 inotify优缺点</h3><p>inotify优点<br>1)监控文件系统事件变化,通过同步工具实现实时数据同步<br>inotify缺点<br>1)并发如果大于200个文(10-100k),同步就会由延迟<br>2)我们前面的脚本,每次都是全部推送一次,但是确实是增量的,也可以只同步变化的文件<br>3)监控到事件后,调用rsync同步是单进程(加&amp;并发)sersync多进程同步<br>既然有了inotify-tools,为什么还需要sersync呢?</p>
<p>sersync功能多:(inotify+rsync命令)</p>
<p>1)支持通过配置文件管理<br>2)真正的守护进程socket<br>3)可以对失败文件定时重传(定时任务功能)<br>4)第三方的HTTP接口(例如:更新cdn缓存)<br>5)默认多线程rsync同步</p>
<h2 id="第三章sersync安装部署"><a href="#第三章sersync安装部署" class="headerlink" title="第三章sersync安装部署"></a>第三章sersync安装部署</h2><table>
<thead>
<tr>
<th>操作系统</th>
<th>服务器角色</th>
<th>IP地址</th>
</tr>
</thead>
<tbody><tr>
<td>CentOS  7.4 x86_64</td>
<td>NFS服务端（nfs-server）</td>
<td>172.16.1.31</td>
</tr>
<tr>
<td>CentOS  7.4 x86_64</td>
<td>NFS备份服务器（backup-server）</td>
<td>172.16.1.41</td>
</tr>
</tbody></table>
<h3 id="3-1-下载sersync"><a href="#3-1-下载sersync" class="headerlink" title="3.1 下载sersync"></a>3.1 下载sersync</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs ~]<span class="comment"># wget https://github.com/wsgzao/sersync/blob/master/sersync2.5.4_64bit_binary_stable_final.tar.gz</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-解压"><a href="#3-2-解压" class="headerlink" title="3.2 解压"></a>3.2 解压</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs /opt]<span class="comment"># tree server/</span></span><br><span class="line">server/</span><br><span class="line">├── confxml.xml</span><br><span class="line">├── confxml.xml.bak</span><br><span class="line">└── sersync2</span><br></pre></td></tr></table></figure>

<h3 id="3-3修改配置文件"><a href="#3-3修改配置文件" class="headerlink" title="3.3修改配置文件"></a>3.3修改配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;sersync&gt;</span><br><span class="line">   24		&lt;localpath watch=<span class="string">"/data"</span>&gt;</span><br><span class="line">   25		    &lt;remote ip=<span class="string">"172.16.1.42"</span> name=<span class="string">"/data"</span>/&gt;</span><br><span class="line">   26		    &lt;!--&lt;remote ip=<span class="string">"192.168.8.39"</span> name=<span class="string">"tongbu"</span>/&gt;--&gt;</span><br><span class="line">   27		    &lt;!--&lt;remote ip=<span class="string">"192.168.8.40"</span> name=<span class="string">"tongbu"</span>/&gt;--&gt;</span><br><span class="line">   28		&lt;/localpath&gt;</span><br><span class="line">   29		&lt;rsync&gt;</span><br><span class="line">   30		    &lt;commonParams params=<span class="string">"-az"</span>/&gt;</span><br><span class="line">   31		    &lt;auth start=<span class="string">"true"</span> users=<span class="string">"rsynd_backup"</span> passwordfile=<span class="string">"/etc/rsyncd.conf"</span>/&gt;</span><br><span class="line">   32		    &lt;userDefinedPort start=<span class="string">"false"</span> port=<span class="string">"874"</span>/&gt;&lt;!-- port=874 --&gt;</span><br><span class="line">   33		    &lt;timeout start=<span class="string">"true"</span> time=<span class="string">"100"</span>/&gt;&lt;!-- timeout=100 --&gt;</span><br><span class="line">   34		    &lt;ssh start=<span class="string">"false"</span>/&gt;</span><br><span class="line">   35		&lt;/rsync&gt;</span><br><span class="line">   36		&lt;failLog path=<span class="string">"/tmp/rsync_fail_log.sh"</span> timeToExecute=<span class="string">"60"</span>/&gt;&lt;!--default every 60mins execute once--&gt;</span><br><span class="line">   37		&lt;crontab start=<span class="string">"false"</span> schedule=<span class="string">"600"</span>&gt;&lt;!--600mins--&gt;</span><br><span class="line">   38		    &lt;crontabfilter start=<span class="string">"false"</span>&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-查看帮助说明"><a href="#3-4-查看帮助说明" class="headerlink" title="3.4 查看帮助说明"></a>3.4 查看帮助说明</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs /opt/server]<span class="comment">#  ./sersync2 -h</span></span><br><span class="line"><span class="built_in">set</span> the system param</span><br><span class="line">execute：<span class="built_in">echo</span> 50000000 &gt; /proc/sys/fs/inotify/max_user_watches</span><br><span class="line">execute：<span class="built_in">echo</span> 327679 &gt; /proc/sys/fs/inotify/max_queued_events</span><br><span class="line">parse the <span class="built_in">command</span> param</span><br><span class="line">_______________________________________________________</span><br><span class="line">参数-d:启用守护进程模式</span><br><span class="line">参数-r:在监控前，将监控目录与远程主机用rsync命令推送一遍</span><br><span class="line">c参数-n: 指定开启守护线程的数量，默认为10个</span><br><span class="line">参数-o:指定配置文件，默认使用confxml.xml文件</span><br><span class="line">参数-m:单独启用其他模块，使用 -m refreshCDN 开启刷新CDN模块</span><br><span class="line">参数-m:单独启用其他模块，使用 -m socket 开启socket模块</span><br><span class="line">参数-m:单独启用其他模块，使用 -m http 开启http模块</span><br><span class="line">不加-m参数，则默认执行同步程序</span><br></pre></td></tr></table></figure>

<h3 id="3-5-启动服务"><a href="#3-5-启动服务" class="headerlink" title="3.5 启动服务"></a>3.5 启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs /opt/server]<span class="comment"># ./sersync2 -n 20 -dro confxml.xml</span></span><br><span class="line"><span class="built_in">set</span> the system param</span><br><span class="line">execute：<span class="built_in">echo</span> 50000000 &gt; /proc/sys/fs/inotify/max_user_watches</span><br><span class="line">execute：<span class="built_in">echo</span> 327679 &gt; /proc/sys/fs/inotify/max_queued_events</span><br><span class="line">parse the <span class="built_in">command</span> param</span><br><span class="line">option: -n 	thread num is：  20</span><br><span class="line">option: -d 	run as a daemon</span><br><span class="line">option: -r 	rsync all the <span class="built_in">local</span> files to the remote servers before the sersync work</span><br><span class="line">option: -o 	config xml name：  confxml.xml</span><br><span class="line">parse xml config file</span><br><span class="line">host ip : localhost	host port: 8008</span><br><span class="line">daemon start，sersync run behind the console </span><br><span class="line">use rsync password-file :</span><br><span class="line">user is	rsynd_backup</span><br><span class="line">passwordfile is 	/etc/rsyncd.conf</span><br><span class="line">config xml parse success</span><br><span class="line">please <span class="built_in">set</span> /etc/rsyncd.conf max connections=0 Manually</span><br><span class="line">sersync working thread 22  = 1(primary thread) + 1(fail retry thread) + 20(daemon sub threads) </span><br><span class="line">Max threads numbers is: 42 = 22(Thread pool nums) + 20(Sub threads)</span><br><span class="line">please according your cpu ，use -n param to adjust the cpu rate</span><br><span class="line">------------------------------------------</span><br><span class="line">rsync the directory recursivly to the remote servers once</span><br><span class="line">working please <span class="built_in">wait</span>...</span><br><span class="line">execute <span class="built_in">command</span>: <span class="built_in">cd</span> /data &amp;&amp; rsync -az -R --delete ./  --timeout=100 rsynd_backup@172.16.1.42::/data --password-file=/etc/rsyncd.conf &gt;/dev/null 2&gt;&amp;1 </span><br><span class="line">run the sersync: </span><br><span class="line">watch path is: /data</span><br></pre></td></tr></table></figure>

<h3 id="3-6-测试数据同步传输"><a href="#3-6-测试数据同步传输" class="headerlink" title="3.6 测试数据同步传输"></a>3.6 测试数据同步传输</h3><p>nfs服务器生成数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs ~]<span class="comment"># cd /data</span></span><br><span class="line">[root@nfs /data]<span class="comment"># for i in &#123;1..1000&#125;;do echo "$&#123;i&#125;"; echo "$&#123;i&#125;" &gt; $&#123;i&#125;.txt;sleep 0.1;done</span></span><br></pre></td></tr></table></figure>

<p>backup备份服务器查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@backup ~]<span class="comment"># cd /data</span></span><br><span class="line">[root@backup /data]<span class="comment"># while true ;do ls |wc -l;sleep 0.1;done</span></span><br></pre></td></tr></table></figure>

<h2 id="第四章-lsyncd-服务"><a href="#第四章-lsyncd-服务" class="headerlink" title="第四章 lsyncd 服务"></a>第四章 lsyncd 服务</h2><p>官网地址：<a href="https://github.com/axkibe/lsyncd" target="_blank" rel="noopener">https://github.com/axkibe/lsyncd</a></p>
<p>Lysncd 实际上是lua语言封装了 inotify 和 rsync 工具，采用了 Linux 内核（2.6.13 及以后）里的 inotify 触发机制，然后通过rsync去差异同步，达到实时的效果。我认为它最令人称道的特性是，完美解决了 <code>inotify + rsync</code>海量文件同步带来的文件频繁发送文件列表的问题 —— 通过时间延迟或累计触发事件次数实现。另外，它的配置方式很简单，lua本身就是一种配置语言，可读性非常强。lsyncd也有多种工作模式可以选择，本地目录cp，本地目录rsync，远程目录rsyncssh。实现简单高效的本地目录同步备份（网络存储挂载也当作本地目录），一个命令搞定。</p>
<h3 id="4-1-安装lsyncd"><a href="#4-1-安装lsyncd" class="headerlink" title="4.1 安装lsyncd"></a>4.1 安装lsyncd</h3><table>
<thead>
<tr>
<th>操作系统</th>
<th>服务器角色</th>
<th>IP地址</th>
</tr>
</thead>
<tbody><tr>
<td>CentOS  7.4 x86_64</td>
<td>NFS服务端（nfs-server）</td>
<td>172.16.1.31</td>
</tr>
<tr>
<td>CentOS  7.4 x86_64</td>
<td>NFS备份服务器（backup-server）</td>
<td>172.16.1.41</td>
</tr>
</tbody></table>
<p>查看包名</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs ~]<span class="comment"># yum provides lsyncd</span></span><br><span class="line">lsyncd-2.2.2-1.el7.x86_64 : File change monitoring and synchronization daemon</span><br><span class="line">Repo        : epel</span><br></pre></td></tr></table></figure>

<p>安装lsyncd服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs ~]<span class="comment"># yum -y install lsyncd</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-创建配置文件"><a href="#4-2-创建配置文件" class="headerlink" title="4.2 创建配置文件"></a>4.2 创建配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs ~]<span class="comment"># rpm -qc lsyncd</span></span><br><span class="line">/etc/lsyncd.conf</span><br><span class="line">[root@nfs /data]<span class="comment"># cat /etc/lsyncd.conf</span></span><br><span class="line">settings &#123;</span><br><span class="line">  logfile = <span class="string">"/var/log/lsyncd/lsyncd.log"</span>,</span><br><span class="line">  statusFile = <span class="string">"/var/log/lsyncd/lsyncd.status"</span>,</span><br><span class="line">  inotifyMode = <span class="string">"CloseWrite"</span>,</span><br><span class="line">  maxProcesses = 8,</span><br><span class="line">&#125;</span><br><span class="line">sync &#123;</span><br><span class="line">  default.rsync,</span><br><span class="line">  <span class="built_in">source</span> = <span class="string">"/data"</span>,</span><br><span class="line">  target = <span class="string">"rsync_backup@172.16.1.41::data"</span>,</span><br><span class="line">  delete= <span class="literal">true</span>,</span><br><span class="line">  exclude = &#123; <span class="string">".*"</span> &#125;,</span><br><span class="line">  delay = 1,</span><br><span class="line">  rsync = &#123;</span><br><span class="line">    binary = <span class="string">"/usr/bin/rsync"</span>,</span><br><span class="line">    archive = <span class="literal">true</span>,</span><br><span class="line">    compress = <span class="literal">true</span>,</span><br><span class="line">    verbose = <span class="literal">true</span>,</span><br><span class="line">    password_file = <span class="string">"/etc/rsync.passwd"</span>,</span><br><span class="line">    _extra = &#123;<span class="string">"--bwlimit=200"</span>&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">sync &#123;</span><br><span class="line">  default.rsync,</span><br><span class="line">  <span class="built_in">source</span> = <span class="string">"/backup"</span>,</span><br><span class="line">  target = <span class="string">"rsync_backup@172.16.1.41::backup"</span>,</span><br><span class="line">  delete= <span class="literal">true</span>,</span><br><span class="line">  exclude = &#123; <span class="string">".*"</span> &#125;,</span><br><span class="line">  delay = 1,</span><br><span class="line">  rsync = &#123;</span><br><span class="line">    binary = <span class="string">"/usr/bin/rsync"</span>,</span><br><span class="line">    archive = <span class="literal">true</span>,</span><br><span class="line">    compress = <span class="literal">true</span>,</span><br><span class="line">    verbose = <span class="literal">true</span>,</span><br><span class="line">    password_file = <span class="string">"/etc/rsync.passwd"</span>,</span><br><span class="line">    _extra = &#123;<span class="string">"--bwlimit=200"</span>&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-配置文件说明"><a href="#4-3-配置文件说明" class="headerlink" title="4.3 配置文件说明"></a>4.3 配置文件说明</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">settings</span><br><span class="line"></span><br><span class="line">里面是全局设置，--开头表示注释，下面是几个常用选项说明：</span><br><span class="line"></span><br><span class="line">logfile <span class="comment">#定义日志文件</span></span><br><span class="line">stausFile <span class="comment">#定义状态文件</span></span><br><span class="line">nodaemon=<span class="literal">true</span> <span class="comment">#表示不启用守护模式，默认</span></span><br><span class="line">statusInterval <span class="comment">#将lsyncd的状态写入上面的statusFile的间隔，默认10秒</span></span><br><span class="line">inotifyMode <span class="comment">#指定inotify监控的事件，默认是CloseWrite，还可以是Modify或CloseWrite or Modify</span></span><br><span class="line">maxProcesses <span class="comment">#同步进程的最大个数。假如同时有20个文件需要同步，而maxProcesses = 8，则最大能看到有8个rysnc进程</span></span><br><span class="line">maxDelays <span class="comment">#累计到多少所监控的事件激活一次同步，即使后面的delay延迟时间还未到</span></span><br><span class="line">sync</span><br><span class="line"></span><br><span class="line">里面是定义同步参数，可以继续使用maxDelays来重写settings的全局变量。一般第一个参数指定lsyncd以什么模式运行：rsync、rsyncssh、direct三种模式：</span><br><span class="line"></span><br><span class="line">default.rsync <span class="comment">#本地目录间同步，使用rsync，也可以达到使用ssh形式的远程rsync效果，或daemon方式连接远程rsyncd进程；</span></span><br><span class="line">default.direct <span class="comment">#本地目录间同步，使用cp、rm等命令完成差异文件备份；</span></span><br><span class="line">default.rsyncssh <span class="comment">#同步到远程主机目录，rsync的ssh模式，需要使用key来认证</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> 同步的源目录，使用绝对路径。</span><br><span class="line"></span><br><span class="line">target 定义目的地址.对应不同的模式有几种写法：</span><br><span class="line">/tmp/dest <span class="comment">#本地目录同步，可用于direct和rsync模式</span></span><br><span class="line">172.16.1.41:/data <span class="comment">#同步到远程服务器目录，可用于rsync和rsyncssh模式，拼接的命令类似于/usr/bin/rsync -ltsd --delete --include-from=- --exclude=* SOURCE TARGET，剩下的就是rsync的内容了，比如指定username，免密码同步</span></span><br><span class="line">172.16.1.41::data <span class="comment">#同步到远程服务器目录，用于rsync模式</span></span><br><span class="line">三种模式的示例会在后面给出。</span><br><span class="line"></span><br><span class="line">init 这是一个优化选项，当init = <span class="literal">false</span>，只同步进程启动以后发生改动事件的文件，原有的目录即使有差异也不会同步。默认是<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">delay 累计事件，等待rsync同步延时时间，默认15秒（最大累计到1000个不可合并的事件）。也就是15s内监控目录下发生的改动，会累积到一次rsync同步，避免过于频繁的同步。（可合并的意思是，15s内两次修改了同一文件，最后只同步最新的文件）</span><br><span class="line"></span><br><span class="line">excludeFrom 排除选项，后面指定排除的列表文件，如excludeFrom = <span class="string">"/etc/lsyncd.exclude"</span>，如果是简单的排除，可以使用exclude = LIST。</span><br><span class="line">这里的排除规则写法与原生rsync有点不同，更为简单：</span><br><span class="line">监控路径里的任何部分匹配到一个文本，都会被排除，例如/bin/foo/bar可以匹配规则foo</span><br><span class="line">如果规则以斜线/开头，则从头开始要匹配全部</span><br><span class="line">如果规则以/结尾，则要匹配监控路径的末尾</span><br><span class="line">?匹配任何字符，但不包括/</span><br><span class="line">*匹配0或多个字符，但不包括/</span><br><span class="line">**匹配0或多个字符，可以是/</span><br><span class="line">delete 为了保持target与souce完全同步，Lsyncd默认会delete = <span class="literal">true</span>来允许同步删除。它除了<span class="literal">false</span>，还有startup、running值，请参考 Lsyncd 2.1.x ‖ Layer 4 Config ‖ Default Behavior。</span><br></pre></td></tr></table></figure>

<h3 id="4-4-启动服务"><a href="#4-4-启动服务" class="headerlink" title="4.4 启动服务"></a>4.4 启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs ~]<span class="comment"># systemctl start lsyncd.service</span></span><br><span class="line">[root@nfs ~]<span class="comment"># systemctl status lsyncd.service</span></span><br></pre></td></tr></table></figure>

<h3 id="4-5-查看日志"><a href="#4-5-查看日志" class="headerlink" title="4.5 查看日志"></a>4.5 查看日志</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs /data]<span class="comment"># tail -f /var/log/lsyncd/lsyncd.log </span></span><br><span class="line">[root@nfs /data]<span class="comment"># tail -f /var/log/lsyncd/lsyncd.status</span></span><br></pre></td></tr></table></figure>

<h3 id="4-6-测试数据"><a href="#4-6-测试数据" class="headerlink" title="4.6 测试数据"></a>4.6 测试数据</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs /data]<span class="comment"># for i in &#123;1..1000&#125;;do echo "$&#123;i&#125;"; echo "$&#123;i&#125;" &gt; $&#123;i&#125;.txt;sleep 0.1;done</span></span><br></pre></td></tr></table></figure>

<p>backup备份服务器查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@backup ~]<span class="comment"># cd /data</span></span><br><span class="line">[root@backup /data]<span class="comment"># while true ;do ls |wc -l;sleep 0.1;done</span></span><br></pre></td></tr></table></figure></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Wu Fei</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://linuxwf.com/2020/04/13/4-NFS%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%97%B6%E5%A4%87%E4%BB%BD/">http://linuxwf.com/2020/04/13/4-NFS%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%97%B6%E5%A4%87%E4%BB%BD/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://linuxwf.com" target="_blank">WF's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/nfs/">nfs</a><a class="post-meta__tags" href="/tags/backup/">backup</a><a class="post-meta__tags" href="/tags/lsyncd/">lsyncd</a></div><div class="post_share"><div class="social-share" data-image="/img/wallhaven-630117.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付宝"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/04/13/5-SSH%E6%9C%8D%E5%8A%A1/"><img class="prev_cover lazyload" data-src="/img/wallhaven-106451.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">5.SSH服务</div></div></a></div><div class="next-post pull_right"><a href="/2020/04/13/3-NFS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"><img class="next_cover lazyload" data-src="/img/wallhaven-33397.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">3.NFS文件系统</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/04/13/3-NFS文件系统/" title="3.NFS文件系统"><img class="relatedPosts_cover lazyload"data-src="/img/wallhaven-33397.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-13</div><div class="relatedPosts_title">3.NFS文件系统</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify: true,
  verify: false,
  appId: 'mJGbzahn0dOntrhO5Hek8Rjd-gzGzoHsz',
  appKey: 'b0O75eIR8ULkl2kyDWLgLXM0',
  placeholder: 'Please leave your footprints',
  avatar: 'monsterid',
  meta: guest_info,
  pageSize: '10',
  lang: 'zh-cn',
  recordIP: false,
  serverURLs: ''
});</script></div></article></main><footer id="footer" style="background-image: url(/img/63199486_p0.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By Wu Fei</div><div class="footer_custom_text">Hi, welcome to my <a href="https://www.linuxwf.com/" target="_blank" rel="noopener">blog</a></div><div class="icp"><a href="http://beian.miit.gov.cn" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"/><span>粤ICP备19138449号-1</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode far fa-moon" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/search/algolia.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":100,"vOffset":-50},"mobile":{"show":true,"scale":0.5}});</script></body></html>