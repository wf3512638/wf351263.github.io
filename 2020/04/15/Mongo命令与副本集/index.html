<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Mongo命令与副本集 | WF's Blog</title><meta name="description" content="Mongo命令与副本集"><meta name="keywords" content="MongoDB"><meta name="author" content="Wu Fei"><meta name="copyright" content="Wu Fei"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://hm.baidu.com"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Mongo命令与副本集"><meta name="twitter:description" content="Mongo命令与副本集"><meta name="twitter:image" content="http://linuxwf.com/img/wallhaven-153272.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Mongo命令与副本集"><meta property="og:url" content="http://linuxwf.com/2020/04/15/Mongo%E5%91%BD%E4%BB%A4%E4%B8%8E%E5%89%AF%E6%9C%AC%E9%9B%86/"><meta property="og:site_name" content="WF's Blog"><meta property="og:description" content="Mongo命令与副本集"><meta property="og:image" content="http://linuxwf.com/img/wallhaven-153272.jpg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="http://linuxwf.com/2020/04/15/Mongo%E5%91%BD%E4%BB%A4%E4%B8%8E%E5%89%AF%E6%9C%AC%E9%9B%86/"><link rel="prev" title="1.shell编程介绍及变量" href="http://linuxwf.com/2020/04/15/1-shell%E7%BC%96%E7%A8%8B%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%8F%98%E9%87%8F/"><link rel="next" title="Mongodb介绍安装" href="http://linuxwf.com/2020/04/15/Mongodb%E4%BB%8B%E7%BB%8D%E5%AE%89%E8%A3%85/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?bf8fa809dbe0a82b3d983accb9d256fe";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"GQXJKQPX6A","apiKey":"9d6901decfc3e9736a8f99965d4fc700","indexName":"my_blog","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: true,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="WF's Blog" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">58</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">39</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 娱乐</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/video/"><i class="fa-fw fa fa-video"></i><span> 视频</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw far fa-images"></i><span> 照片</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fa fa-book"></i><span> 书籍</span></a></li><li><a class="site-page" href="/games/"><i class="fa-fw fa fa-gamepad"></i><span> Game</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Mongo进阶"><span class="toc-number">1.</span> <span class="toc-text">Mongo进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#第1章-Mongo基本操作"><span class="toc-number">1.1.</span> <span class="toc-text">第1章 Mongo基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-介绍"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-显示命令"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 显示命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-MongoDB-CRUD操作"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3 MongoDB CRUD操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-插入文件"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">1.插入文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-查询数据"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">2.查询数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-更新数据"><span class="toc-number">1.1.3.3.</span> <span class="toc-text">3.更新数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-删除文件"><span class="toc-number">1.1.3.4.</span> <span class="toc-text">4.删除文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-创建索引"><span class="toc-number">1.1.4.</span> <span class="toc-text">1.4 创建索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-查看执行计划"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">1.查看执行计划</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-创建索引"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">2.创建索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-查看索引"><span class="toc-number">1.1.4.3.</span> <span class="toc-text">3.查看索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-再次查看执行计划"><span class="toc-number">1.1.4.4.</span> <span class="toc-text">4.再次查看执行计划</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第2章-工具介绍"><span class="toc-number">1.2.</span> <span class="toc-text">第2章 工具介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-mongod"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 mongod</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-mongos"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 mongos</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-Mongostat"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 Mongostat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-Mongotop"><span class="toc-number">1.2.4.</span> <span class="toc-text">2.4 Mongotop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-Mongooplog"><span class="toc-number">1.2.5.</span> <span class="toc-text">2.5 Mongooplog</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第3章-授权认证"><span class="toc-number">1.3.</span> <span class="toc-text">第3章 授权认证</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-官方网址"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 官方网址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-授权介绍"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 授权介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-创建用户和角色"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3 创建用户和角色</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第4章-副本集配置"><span class="toc-number">1.4.</span> <span class="toc-text">第4章 副本集配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-官方网站"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 官方网站</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-创建多实例副本集"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 创建多实例副本集</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-创建节点目录和数据目录"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">1.创建节点目录和数据目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-创建配置文件"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">2.创建配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-复制配置文件到其他节点"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">3.复制配置文件到其他节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-替换端口号"><span class="toc-number">1.4.2.4.</span> <span class="toc-text">4.替换端口号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-启动所有节点"><span class="toc-number">1.4.2.5.</span> <span class="toc-text">5.启动所有节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-初始化集群"><span class="toc-number">1.4.2.6.</span> <span class="toc-text">6.初始化集群</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-插入数据"><span class="toc-number">1.4.2.7.</span> <span class="toc-text">7.插入数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-副本节点登录查看数据"><span class="toc-number">1.4.2.8.</span> <span class="toc-text">8.副本节点登录查看数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-设置副本可读"><span class="toc-number">1.4.2.9.</span> <span class="toc-text">9.设置副本可读</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-副本集权重调整"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3 副本集权重调整</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-查看当前副本集配置"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">1.查看当前副本集配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-设置权重"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">2.设置权重</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-主节点主动降级"><span class="toc-number">1.4.3.3.</span> <span class="toc-text">3.主节点主动降级</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-增加新节点和删除旧节点"><span class="toc-number">1.4.4.</span> <span class="toc-text">4.4 增加新节点和删除旧节点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-创建新节点并启动"><span class="toc-number">1.4.4.1.</span> <span class="toc-text">1.创建新节点并启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-集群添加节点"><span class="toc-number">1.4.4.2.</span> <span class="toc-text">2.集群添加节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-删除节点"><span class="toc-number">1.4.4.3.</span> <span class="toc-text">3.删除节点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-仲裁节点"><span class="toc-number">1.4.5.</span> <span class="toc-text">4.5 仲裁节点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-创建新节点并启动-1"><span class="toc-number">1.4.5.1.</span> <span class="toc-text">1.创建新节点并启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-将仲裁节点加入集群"><span class="toc-number">1.4.5.2.</span> <span class="toc-text">2.将仲裁节点加入集群</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第5章-mongo备份与恢复"><span class="toc-number">1.5.</span> <span class="toc-text">第5章 mongo备份与恢复</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-工具介绍"><span class="toc-number">1.5.1.</span> <span class="toc-text">1.工具介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-应用场景"><span class="toc-number">1.5.2.</span> <span class="toc-text">2.应用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-导出工具mongoexport"><span class="toc-number">1.5.3.</span> <span class="toc-text">3.导出工具mongoexport</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-恢复"><span class="toc-number">1.5.4.</span> <span class="toc-text">4.恢复</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-mysql数据迁移到mongo"><span class="toc-number">1.5.5.</span> <span class="toc-text">5.mysql数据迁移到mongo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-导出与恢复"><span class="toc-number">1.5.6.</span> <span class="toc-text">6.导出与恢复</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-模拟误删除恢复"><span class="toc-number">1.5.7.</span> <span class="toc-text">7.模拟误删除恢复</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-Mongodump备份数据"><span class="toc-number">1.5.8.</span> <span class="toc-text">8.Mongodump备份数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-Mongorestore恢复数据"><span class="toc-number">1.5.9.</span> <span class="toc-text">9.Mongorestore恢复数据</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(/img/wallhaven-153272.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">WF's Blog</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 娱乐</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/video/"><i class="fa-fw fa fa-video"></i><span> 视频</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw far fa-images"></i><span> 照片</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fa fa-book"></i><span> 书籍</span></a></li><li><a class="site-page" href="/games/"><i class="fa-fw fa fa-gamepad"></i><span> Game</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Mongo命令与副本集</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-04-15 11:01:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-04-15</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-04-15 11:08:40"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-04-15</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon far fa-file-word" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">4.7k</span><span class="post-meta__separator">|</span><i class="post-meta__icon far fa-clock" aria-hidden="true"></i><span>阅读时长: 19 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon far fa-comments" aria-hidden="true"></i><span>评论数:</span><a href="/2020/04/15/Mongo%E5%91%BD%E4%BB%A4%E4%B8%8E%E5%89%AF%E6%9C%AC%E9%9B%86/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2020/04/15/Mongo%E5%91%BD%E4%BB%A4%E4%B8%8E%E5%89%AF%E6%9C%AC%E9%9B%86/" itemprop="commentCount"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h1 id="Mongo进阶"><a href="#Mongo进阶" class="headerlink" title="Mongo进阶"></a>Mongo进阶</h1><h2 id="第1章-Mongo基本操作"><a href="#第1章-Mongo基本操作" class="headerlink" title="第1章 Mongo基本操作"></a>第1章 Mongo基本操作</h2><h3 id="1-1-介绍"><a href="#1-1-介绍" class="headerlink" title="1.1 介绍"></a>1.1 介绍</h3><p>CRUD 操作是create(创建)， read(读取)， update(更新)和delete(删除) 文档。<br>MongoDB 不支持SQL 但是支持自己的丰富的查询语言。<br>在MongoDB 中，存储在集合中的每个文档都需要一个唯一的_id 字段，作为主键。如果插入的文档省略了该_id字段，则MongoDB 驱动程序将自动为该字段生成一个ObjectId_id。也用于通过更新操作插入的文档upsert: true.<br>如果文档包含一个_id 字段，该_id 值在集合中必须是唯一的，以避免重复键错误。<br>在MongoDB 中，插入操作针对单个集合。MongoDB 中的所有写操作都是在单个文档的级别上进行的</p>
<h3 id="1-2-显示命令"><a href="#1-2-显示命令" class="headerlink" title="1.2 显示命令"></a>1.2 显示命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Help: 显示帮助。</span><br><span class="line">db.help() 显示数据库方法的帮助。</span><br><span class="line">db.&lt;collection&gt;.<span class="built_in">help</span>() 显示收集方法的帮助， &lt;collection&gt;可以是现有的集合或不存在的集合的名称。</span><br><span class="line">show dbs 打印服务器上所有数据库的列表。</span><br><span class="line">use &lt;db&gt; 将当前数据库切换到&lt;db&gt;。该mongoshell 变量db 被设置为当前数据库。</span><br><span class="line">show collections 打印当前数据库的所有集合的列表</span><br><span class="line">show users 打印当前数据库的用户列表。</span><br><span class="line">show roles 打印用于当前数据库的用户定义和内置的所有角色的列表。</span><br><span class="line">show profile 打印需要1 毫秒或更多的五个最近的操作。有关详细信息，请参阅数据库分析器上的文档。</span><br><span class="line">show databases 打印所有可用数据库的列表。</span><br><span class="line">load() 执行一个JavaScript 文件。</span><br></pre></td></tr></table></figure>

<h3 id="1-3-MongoDB-CRUD操作"><a href="#1-3-MongoDB-CRUD操作" class="headerlink" title="1.3 MongoDB CRUD操作"></a>1.3 MongoDB CRUD操作</h3><p>官方文档 <a href="https://docs.mongodb.com/manual/crud/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/crud/</a></p>
<h4 id="1-插入文件"><a href="#1-插入文件" class="headerlink" title="1.插入文件"></a>1.插入文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.insertOne()</span><br><span class="line">db.inventory.insertMany()</span><br><span class="line">db.inventory.find( &#123;&#125; )  ---&gt; 查询</span><br></pre></td></tr></table></figure>

<p><strong>单行插入</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.insertOne(</span><br><span class="line">   &#123; item: <span class="string">"canvas"</span>, qty: 100, tags: [<span class="string">"cotton"</span>], size: &#123; h: 28, w: 35.5, uom: <span class="string">"cm"</span> &#125; &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>多行插入</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.insertMany([</span><br><span class="line">   &#123; item: <span class="string">"journal"</span>, qty: 25, tags: [<span class="string">"blank"</span>, <span class="string">"red"</span>], size: &#123; h: 14, w: 21, uom: <span class="string">"cm"</span> &#125; &#125;,</span><br><span class="line">   &#123; item: <span class="string">"mat"</span>, qty: 85, tags: [<span class="string">"gray"</span>], size: &#123; h: 27.9, w: 35.5, uom: <span class="string">"cm"</span> &#125; &#125;,</span><br><span class="line">   &#123; item: <span class="string">"mousepad"</span>, qty: 25, tags: [<span class="string">"gel"</span>, <span class="string">"blue"</span>], size: &#123; h: 19, w: 22.85, uom: <span class="string">"cm"</span> &#125; &#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<h4 id="2-查询数据"><a href="#2-查询数据" class="headerlink" title="2.查询数据"></a>2.查询数据</h4><p><strong>查询所有</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.find( &#123;&#125; )</span><br><span class="line">SELECT * FROM inventory   --&gt; MySQL查询</span><br></pre></td></tr></table></figure>

<p><strong>指定条件查询</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.find( &#123; status: <span class="string">"D"</span> &#125; )</span><br><span class="line">SELECT * FROM inventory WHERE status = <span class="string">"D"</span>	--&gt; MySQL查询</span><br></pre></td></tr></table></figure>

<p><strong>指定条件下使用查询运算符</strong></p>
<p>从inventory 集合中检索status等于”A”或的所有文档”D”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.find( &#123; status: &#123; <span class="variable">$in</span>: [ <span class="string">"A"</span>, <span class="string">"D"</span> ] &#125; &#125; )</span><br><span class="line">SELECT * FROM inventory WHERE status <span class="keyword">in</span> (<span class="string">"A"</span>, <span class="string">"D"</span>)		--&gt; MySQL查询</span><br></pre></td></tr></table></figure>

<p><strong>指定AND条件</strong></p>
<p>检索inventory 集合中status等于”A” 和 qty数量$lt小于30的所有文档</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.find( &#123; status: <span class="string">"A"</span>, qty: &#123; <span class="variable">$lt</span>: 30 &#125; &#125; )</span><br><span class="line">SELECT * FROM inventory WHERE status = <span class="string">"A"</span> AND qty &lt; 30</span><br></pre></td></tr></table></figure>

<p><strong>指定OR条件</strong></p>
<p>检索inventory 集合中status等于”A” 或 qty数量$lt小于30的所有文档</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.find( &#123; <span class="variable">$or</span>: [ &#123; status: <span class="string">"A"</span> &#125;, &#123; qty: &#123; <span class="variable">$lt</span>: 30 &#125; &#125; ] &#125; )</span><br><span class="line">SELECT * FROM inventory WHERE status = <span class="string">"A"</span> OR qty &lt; 30		--&gt; MySQL查询</span><br></pre></td></tr></table></figure>

<p><strong>指定AND和OR条件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.find( &#123;</span><br><span class="line">     status: <span class="string">"A"</span>,</span><br><span class="line">     <span class="variable">$or</span>: [ &#123; qty: &#123; <span class="variable">$lt</span>: 30 &#125; &#125;, &#123; item: /^p/ &#125; ]</span><br><span class="line">&#125; )</span><br><span class="line"></span><br><span class="line">SELECT * FROM inventory WHERE status = <span class="string">"A"</span> AND ( qty &lt; 30 OR item LIKE <span class="string">"p%"</span>)</span><br></pre></td></tr></table></figure>

<p><strong>查看数据库命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; show dbs</span><br><span class="line">admin 0.000GB</span><br><span class="line"><span class="built_in">local</span> 0.000GB</span><br><span class="line"><span class="built_in">test</span> 0.000GB</span><br><span class="line">test2 0.000GB</span><br><span class="line">&gt; use <span class="built_in">test</span></span><br><span class="line">switched to db <span class="built_in">test</span></span><br><span class="line">&gt; db</span><br><span class="line"><span class="built_in">test</span></span><br><span class="line">&gt; show collections</span><br><span class="line">inventory</span><br><span class="line"><span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<h4 id="3-更新数据"><a href="#3-更新数据" class="headerlink" title="3.更新数据"></a>3.更新数据</h4><p>以下集合为例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.insertMany( [</span><br><span class="line">   &#123; item: <span class="string">"canvas"</span>, qty: 100, size: &#123; h: 28, w: 35.5, uom: <span class="string">"cm"</span> &#125;, status: <span class="string">"A"</span> &#125;,</span><br><span class="line">   &#123; item: <span class="string">"journal"</span>, qty: 25, size: &#123; h: 14, w: 21, uom: <span class="string">"cm"</span> &#125;, status: <span class="string">"A"</span> &#125;,</span><br><span class="line">   &#123; item: <span class="string">"mat"</span>, qty: 85, size: &#123; h: 27.9, w: 35.5, uom: <span class="string">"cm"</span> &#125;, status: <span class="string">"A"</span> &#125;,</span><br><span class="line">   &#123; item: <span class="string">"mousepad"</span>, qty: 25, size: &#123; h: 19, w: 22.85, uom: <span class="string">"cm"</span> &#125;, status: <span class="string">"P"</span> &#125;,</span><br><span class="line">   &#123; item: <span class="string">"notebook"</span>, qty: 50, size: &#123; h: 8.5, w: 11, uom: <span class="string">"in"</span> &#125;, status: <span class="string">"P"</span> &#125;,</span><br><span class="line">   &#123; item: <span class="string">"paper"</span>, qty: 100, size: &#123; h: 8.5, w: 11, uom: <span class="string">"in"</span> &#125;, status: <span class="string">"D"</span> &#125;,</span><br><span class="line">   &#123; item: <span class="string">"planner"</span>, qty: 75, size: &#123; h: 22.85, w: 30, uom: <span class="string">"cm"</span> &#125;, status: <span class="string">"D"</span> &#125;,</span><br><span class="line">   &#123; item: <span class="string">"postcard"</span>, qty: 45, size: &#123; h: 10, w: 15.25, uom: <span class="string">"cm"</span> &#125;, status: <span class="string">"A"</span> &#125;,</span><br><span class="line">   &#123; item: <span class="string">"sketchbook"</span>, qty: 80, size: &#123; h: 14, w: 21, uom: <span class="string">"cm"</span> &#125;, status: <span class="string">"A"</span> &#125;,</span><br><span class="line">   &#123; item: <span class="string">"sketch pad"</span>, qty: 95, size: &#123; h: 22.85, w: 30.5, uom: <span class="string">"cm"</span> &#125;, status: <span class="string">"A"</span> &#125;</span><br><span class="line">] );</span><br></pre></td></tr></table></figure>

<p><strong>更新单个文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.updateOne(</span><br><span class="line">   &#123; item: <span class="string">"paper"</span> &#125;,</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="variable">$set</span>: &#123; <span class="string">"size.uom"</span>: <span class="string">"cm"</span>, status: <span class="string">"P"</span> &#125;,</span><br><span class="line">     <span class="variable">$currentDate</span>: &#123; lastModified: <span class="literal">true</span> &#125;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>更新多个文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.updateMany(</span><br><span class="line">   &#123; <span class="string">"qty"</span>: &#123; <span class="variable">$lt</span>: 50 &#125; &#125;,</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="variable">$set</span>: &#123; <span class="string">"size.uom"</span>: <span class="string">"in"</span>, status: <span class="string">"P"</span> &#125;,</span><br><span class="line">     <span class="variable">$currentDate</span>: &#123; lastModified: <span class="literal">true</span> &#125;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>更换文件</strong></p>
<p>下面的示例替换集合中的<em>第一个</em>文档， <code>inventory</code>其中：<code>item: &quot;paper&quot;</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.replaceOne(</span><br><span class="line">   &#123; item: <span class="string">"paper"</span> &#125;,</span><br><span class="line">   &#123; item: <span class="string">"paper"</span>, instock: [ &#123; warehouse: <span class="string">"A"</span>, qty: 60 &#125;, &#123; warehouse: <span class="string">"B"</span>, qty: 40 &#125; ] &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="4-删除文件"><a href="#4-删除文件" class="headerlink" title="4.删除文件"></a>4.删除文件</h4><p>以下集合为例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.insertMany( [</span><br><span class="line">   &#123; item: <span class="string">"journal"</span>, qty: 25, size: &#123; h: 14, w: 21, uom: <span class="string">"cm"</span> &#125;, status: <span class="string">"A"</span> &#125;,</span><br><span class="line">   &#123; item: <span class="string">"notebook"</span>, qty: 50, size: &#123; h: 8.5, w: 11, uom: <span class="string">"in"</span> &#125;, status: <span class="string">"P"</span> &#125;,</span><br><span class="line">   &#123; item: <span class="string">"paper"</span>, qty: 100, size: &#123; h: 8.5, w: 11, uom: <span class="string">"in"</span> &#125;, status: <span class="string">"D"</span> &#125;,</span><br><span class="line">   &#123; item: <span class="string">"planner"</span>, qty: 75, size: &#123; h: 22.85, w: 30, uom: <span class="string">"cm"</span> &#125;, status: <span class="string">"D"</span> &#125;,</span><br><span class="line">   &#123; item: <span class="string">"postcard"</span>, qty: 45, size: &#123; h: 10, w: 15.25, uom: <span class="string">"cm"</span> &#125;, status: <span class="string">"A"</span> &#125;,</span><br><span class="line">] );</span><br></pre></td></tr></table></figure>

<p><strong>删除所有文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.deleteMany(&#123;&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>删除所有符合条件的文档</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.deleteMany(&#123; status : <span class="string">"A"</span> &#125;)</span><br></pre></td></tr></table></figure>

<p><strong>仅删除一个符合条件的文档</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.deleteOne( &#123; status: <span class="string">"D"</span> &#125; )</span><br></pre></td></tr></table></figure>

<h3 id="1-4-创建索引"><a href="#1-4-创建索引" class="headerlink" title="1.4 创建索引"></a>1.4 创建索引</h3><p>默认情况下，创建索引将阻止数据库上的所有其他操作。在集合上构建索引时，保存集合的数据库对于读取或写入操作是不可用的，直到索引构建完成。任何需要对所有数据库（例如listDatabases）进行读或写锁定的操作将等待前台索引构建完成。<br>对于可能需要长时间运行的索引创建操作，可以考虑background 选项，这样MongoDB 数据库在索引创建期间仍然是可用的。例如，在people 集合的zipcode 键上创建一个索引，这个过程在后台运行，可以使用如下方式：<br>db.people.createIndex( { zipcode: 1}, {background: true} )<br>默认MongoDB 索引创建的background 是false 。<br>索引优化： db.test.find({“id”:100}).explain()</p>
<h4 id="1-查看执行计划"><a href="#1-查看执行计划" class="headerlink" title="1.查看执行计划"></a>1.查看执行计划</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.find(&#123;<span class="string">"age"</span>:&#123; <span class="variable">$lt</span>: 30 &#125;&#125;).explain()</span><br></pre></td></tr></table></figure>

<h4 id="2-创建索引"><a href="#2-创建索引" class="headerlink" title="2.创建索引"></a>2.创建索引</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.createIndex( &#123; age: 1 &#125; )</span><br></pre></td></tr></table></figure>

<h4 id="3-查看索引"><a href="#3-查看索引" class="headerlink" title="3.查看索引"></a>3.查看索引</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.getIndexes()</span><br></pre></td></tr></table></figure>

<h4 id="4-再次查看执行计划"><a href="#4-再次查看执行计划" class="headerlink" title="4.再次查看执行计划"></a>4.再次查看执行计划</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">关键词</span><br><span class="line"><span class="string">"stage"</span> : <span class="string">"IXSCAN"</span></span><br><span class="line"><span class="string">"indexName"</span> : <span class="string">"age_1"</span></span><br></pre></td></tr></table></figure>

<h2 id="第2章-工具介绍"><a href="#第2章-工具介绍" class="headerlink" title="第2章 工具介绍"></a>第2章 工具介绍</h2><p>官网地址</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://docs.mongodb.com/manual/reference/program/</span><br></pre></td></tr></table></figure>

<p>MongoDB软件包中的核心组件是：mongod核心数据库进程；mongos分片集群的控制器和查询路由器; 以及 mongo交互式MongoDB Shell。</p>
<h3 id="2-1-mongod"><a href="#2-1-mongod" class="headerlink" title="2.1 mongod"></a>2.1 mongod</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Mongod 是Mongodb 系统的主要守护进程，它处理数据请求，管理数据访问，并执行后台</span><br><span class="line">管理操作。启动进程指定配置文件，控制数据库的行为</span><br></pre></td></tr></table></figure>

<h3 id="2-2-mongos"><a href="#2-2-mongos" class="headerlink" title="2.2 mongos"></a>2.2 mongos</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mongos 对于“ MongoDB Shard”，是用于处理来自应用层的查询的MongoDB 分片配置的路由服务，并确</span><br><span class="line">定此数据在分片集群中的位置， 以完成这些操作。从应用程序的角度来看，一个mongos 实例与任何其他</span><br><span class="line">MongoDB 实例的行为相同</span><br></pre></td></tr></table></figure>

<h3 id="2-3-Mongostat"><a href="#2-3-Mongostat" class="headerlink" title="2.3 Mongostat"></a>2.3 Mongostat</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mongostat 实用程序可以快速概览当前正在运行的mongod 或mongos 实例的状态。mongostat 在功能上类似于UNIX / Linux 文件系统实用程序vmstat，但提供有关的数据mongod 和mongos 实例</span><br></pre></td></tr></table></figure>

<h3 id="2-4-Mongotop"><a href="#2-4-Mongotop" class="headerlink" title="2.4 Mongotop"></a>2.4 Mongotop</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Mongotop 提供了一种跟踪MongoDB 实例读取和写入数据的时间量的方法。mongotop 提供每个收集级别</span><br><span class="line">的统计信息。默认情况下，mongotop 每秒返回一次值</span><br></pre></td></tr></table></figure>

<h3 id="2-5-Mongooplog"><a href="#2-5-Mongooplog" class="headerlink" title="2.5 Mongooplog"></a>2.5 Mongooplog</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Mongooplog 是一个简单的工具，可以从远程服务器的复制oplog 轮询操作，并将其应用于本地服务器。此功能支持某些类型的实时迁移，这些迁移要求源服务器保持联机并在整个迁移过程中运行。通常，此命令将采用以下形式:</span><br><span class="line">mongooplog - from mongodb0.example.net --host mongodb1.example.net</span><br></pre></td></tr></table></figure>

<h2 id="第3章-授权认证"><a href="#第3章-授权认证" class="headerlink" title="第3章 授权认证"></a>第3章 授权认证</h2><h3 id="3-1-官方网址"><a href="#3-1-官方网址" class="headerlink" title="3.1 官方网址"></a>3.1 官方网址</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://docs.mongodb.com/manual/reference/configuration-options/<span class="comment">#security-options</span></span><br><span class="line">https://docs.mongodb.com/manual/tutorial/<span class="built_in">enable</span>-authentication/</span><br></pre></td></tr></table></figure>

<h3 id="3-2-授权介绍"><a href="#3-2-授权介绍" class="headerlink" title="3.2 授权介绍"></a>3.2 授权介绍</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">用户管理界面</span><br><span class="line">要添加用户， MongoDB 提供了该db.createUser()方法。添加用户时，您可以为用户分配色以授予权限。</span><br><span class="line">注意：</span><br><span class="line">在数据库中创建的第一个用户应该是具有管理其他用户的权限的用户管理员。</span><br><span class="line">您还可以更新现有用户，例如更改密码并授予或撤销角色。</span><br></pre></td></tr></table></figure>

<p><strong>操作命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">db.auth() 将用户验证到数据库。</span><br><span class="line">db.changeUserPassword() 更改现有用户的密码。</span><br><span class="line">db.createUser() 创建一个新用户。</span><br><span class="line">db.dropUser() 删除单个用户。</span><br><span class="line">db.dropAllUsers() 删除与数据库关联的所有用户。</span><br><span class="line">db.getUser() 返回有关指定用户的信息。</span><br><span class="line">db.getUsers() 返回有关与数据库关联的所有用户的信息。</span><br><span class="line">db.grantRolesToUser() 授予用户角色及其特权。</span><br><span class="line">db.removeUser() 已过时。从数据库中删除用户。</span><br><span class="line">db.revokeRolesFromUser() 从用户中删除角色。</span><br><span class="line">db.updateUser() 更新用户数据。</span><br></pre></td></tr></table></figure>

<h3 id="3-3-创建用户和角色"><a href="#3-3-创建用户和角色" class="headerlink" title="3.3 创建用户和角色"></a>3.3 创建用户和角色</h3><p>1.创建管理用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mongo db01:27017</span><br><span class="line">use admin </span><br><span class="line">db.createUser(</span><br><span class="line">	&#123;</span><br><span class="line">		user: <span class="string">"admin"</span>,</span><br><span class="line">		<span class="built_in">pwd</span>: <span class="string">"123456"</span>,</span><br><span class="line">		roles:[ </span><br><span class="line">				&#123; </span><br><span class="line">					role: <span class="string">"root"</span>, </span><br><span class="line">					db:<span class="string">"admin"</span></span><br><span class="line">				&#125;</span><br><span class="line">			  ]</span><br><span class="line">	&#125;	</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>2.查看创建的用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.getUsers()</span><br></pre></td></tr></table></figure>

<p>3.配置文件添加权限认证参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">security: <span class="comment">#认证</span></span><br><span class="line">authorization: enabled </span><br><span class="line"><span class="comment">#启用或者禁用基于角色的访问控制来管理每个用户对数据库资源和操作的访问</span></span><br><span class="line">enabled 或者 disables</span><br></pre></td></tr></table></figure>

<p>4.重启mongo</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mongod -f /opt/mongo_27017/conf/mongodb.conf --shutdown</span><br><span class="line">mongod -f /opt/mongo_27017/conf/mongodb.conf</span><br></pre></td></tr></table></figure>

<p>5.登录</p>
<p>配置问权限认证后需要重启节点，再次登陆如果不使用账号密码就查看不了数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo db01:27017 -uadmin -p --authenticationDatabase admin</span><br></pre></td></tr></table></figure>

<p>6.创建其他用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">use <span class="built_in">test</span></span><br><span class="line">db.createUser(</span><br><span class="line">  &#123;</span><br><span class="line">    user: <span class="string">"mysun"</span>,</span><br><span class="line">    <span class="built_in">pwd</span>: <span class="string">"123456"</span>,</span><br><span class="line">    roles: [ &#123; role: <span class="string">"readWrite"</span>, db: <span class="string">"write"</span> &#125;,</span><br><span class="line">             &#123; role: <span class="string">"read"</span>, db: <span class="string">"read"</span> &#125; ]</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>7.创建测试数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">use write</span><br><span class="line">db.write.insert(&#123;<span class="string">"name"</span>:<span class="string">"zhangya"</span>,<span class="string">"age"</span>:27,<span class="string">"ad"</span>:<span class="string">"北京市朝阳区"</span>&#125;)</span><br><span class="line">db.write.insert(&#123;<span class="string">"name"</span>:<span class="string">"zhangya"</span>,<span class="string">"age"</span>:27,<span class="string">"ad"</span>:<span class="string">"北京市朝阳区"</span>&#125;)</span><br><span class="line">db.write.insert(&#123;<span class="string">"name"</span>:<span class="string">"yazhang"</span>,<span class="string">"age"</span>:28,<span class="string">"ad"</span>:<span class="string">"北京市朝阳区"</span>&#125;)</span><br><span class="line">db.write.insert(&#123;<span class="string">"name"</span>:<span class="string">"xiaozhang"</span>,<span class="string">"age"</span>:28,<span class="string">"ad"</span>:<span class="string">"北京市朝阳区"</span>&#125;)</span><br><span class="line">db.write.insert(&#123;<span class="string">"name"</span>:<span class="string">"xiaozhang"</span>,<span class="string">"age"</span>:28,<span class="string">"ad"</span>:<span class="string">"北京市朝阳区"</span>,<span class="string">"sex"</span>:<span class="string">"boy"</span>&#125;)</span><br><span class="line"></span><br><span class="line">use <span class="built_in">read</span></span><br><span class="line">db.read.insert(&#123;<span class="string">"name"</span>:<span class="string">"zhangya"</span>,<span class="string">"age"</span>:27,<span class="string">"ad"</span>:<span class="string">"北京市朝阳区"</span>&#125;)</span><br><span class="line">db.read.insert(&#123;<span class="string">"name"</span>:<span class="string">"zhangya"</span>,<span class="string">"age"</span>:27,<span class="string">"ad"</span>:<span class="string">"北京市朝阳区"</span>&#125;)</span><br><span class="line">db.read.insert(&#123;<span class="string">"name"</span>:<span class="string">"yazhang"</span>,<span class="string">"age"</span>:28,<span class="string">"ad"</span>:<span class="string">"北京市朝阳区"</span>&#125;)</span><br><span class="line">db.read.insert(&#123;<span class="string">"name"</span>:<span class="string">"xiaozhang"</span>,<span class="string">"age"</span>:28,<span class="string">"ad"</span>:<span class="string">"北京市朝阳区"</span>&#125;)</span><br><span class="line">db.read.insert(&#123;<span class="string">"name"</span>:<span class="string">"xiaozhang"</span>,<span class="string">"age"</span>:28,<span class="string">"ad"</span>:<span class="string">"北京市朝阳区"</span>,<span class="string">"sex"</span>:<span class="string">"boy"</span>&#125;)</span><br></pre></td></tr></table></figure>

<p>8.退出admin，使用mysun用户登录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mongo db01:27017 -umysun -p --authenticationDatabase <span class="built_in">test</span></span><br><span class="line">use write</span><br><span class="line">db.write.find()</span><br><span class="line">db.write.insert(&#123;<span class="string">"name"</span>:<span class="string">"zhangya"</span>,<span class="string">"age"</span>:27,<span class="string">"ad"</span>:<span class="string">"北京市朝阳区"</span>&#125;)</span><br><span class="line"></span><br><span class="line">use <span class="built_in">read</span></span><br><span class="line">db.read.find()</span><br><span class="line">db.read.insert(&#123;<span class="string">"name"</span>:<span class="string">"zhangya"</span>,<span class="string">"age"</span>:27,<span class="string">"ad"</span>:<span class="string">"北京市朝阳区"</span>&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="第4章-副本集配置"><a href="#第4章-副本集配置" class="headerlink" title="第4章 副本集配置"></a>第4章 副本集配置</h2><h3 id="4-1-官方网站"><a href="#4-1-官方网站" class="headerlink" title="4.1 官方网站"></a>4.1 官方网站</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://docs.mongodb.com/manual/replication/</span><br></pre></td></tr></table></figure>

<p>在MongoDB中复制<br>副本集是一组mongod维护相同数据集的实例。一个副本集包含多个数据承载节点和一个仲裁器节点（可选）。在数据承载节点中，只有一个成员被视为主要节点，而其他节点则被视为次要节点。</p>
<p>所述主节点接收所有的写操作。副本集只能有一个能够确认与 写入有关的写入的主数据库。尽管在某些情况下，另一个mongod实例可能会暂时认为自己也是主要实例。 [1]主数据库在其操作日志（即oplog）中记录对其数据集的所有更改</p>
<p><img src="/" class="lazyload" data-src="http://cdn.linuxwf.com/img/mysql/mongodb01.png"  alt=""></p>
<p>该次级复制初级的OPLOG和应用操作的数据集，使得次级数据集反映了主要的数据集。如果主要节点不可用，则符合条件的次要节点将进行选举以自行选举新的主要节点。</p>
<p><img src="/" class="lazyload" data-src="http://cdn.linuxwf.com/img/mysql/mongodb02.png"  alt=""></p>
<p>您可以将一个额外的<a href="https://docs.mongodb.com/manual/reference/program/mongod/#bin.mongod" target="_blank" rel="noopener"><code>mongod</code></a>实例作为<a href="https://docs.mongodb.com/manual/core/replica-set-arbiter/" target="_blank" rel="noopener">仲裁器</a>添加到副本集 。仲裁者不维护数据集。仲裁程序的目的是通过响应其他副本集成员的心跳和选举请求来维护副本集中的仲裁。由于仲裁器不存储数据集，因此它是提供副本集仲裁功能且资源成本比具有数据集的功能齐全的副本集成员便宜的好方法。如果您的副本集成员数为偶数，请添加仲裁程序以<a href="https://docs.mongodb.com/manual/reference/command/replSetGetStatus/#replSetGetStatus.majorityVoteCount" target="_blank" rel="noopener"><code>majority</code></a>在主要选举中获得票数。仲裁器不需要专用硬件。</p>
<p><img src="/" class="lazyload" data-src="http://cdn.linuxwf.com/img/mysql/mongodb03.png"  alt=""></p>
<p><strong>异步复制</strong></p>
<p>辅助节点复制主节点的操作日志，并将操作异步应用于其数据集。通过使次要节点的数据集反映主要节点的数据集，即使一个或多个成员失败，副本集也可以继续运行。</p>
<p><strong>复制延迟和流控制</strong></p>
<p><a href="https://docs.mongodb.com/manual/reference/glossary/#term-replication-lag" target="_blank" rel="noopener">复制滞后</a>是指将<a href="https://docs.mongodb.com/manual/reference/glossary/#term-primary" target="_blank" rel="noopener">主</a>操作上的写操作复制（即复制）到<a href="https://docs.mongodb.com/manual/reference/glossary/#term-secondary" target="_blank" rel="noopener">辅助</a>上所花费的时间 。可以接受一些小的延迟时间，但是随着复制滞后的增加会出现严重的问题，包括在主数据库上增加缓存压力。</p>
<p>从MongoDB 4.2开始，管理员可以限制主数据库应用其写入的速率，以将延迟保持在可配置的最大值以下。<a href="https://docs.mongodb.com/manual/reference/command/replSetGetStatus/#replSetGetStatus.optimes.lastCommittedOpTime" target="_blank" rel="noopener"><code>majority committed</code></a><a href="https://docs.mongodb.com/manual/reference/parameters/#param.flowControlTargetLagSeconds" target="_blank" rel="noopener"><code>flowControlTargetLagSeconds</code></a></p>
<p>默认情况下，流量控制为<a href="https://docs.mongodb.com/manual/reference/parameters/#param.enableFlowControl" target="_blank" rel="noopener"><code>enabled</code></a>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#注意</span></span><br><span class="line">为了启用流控制，副本集/分片集群必须具有：featureCompatibilityVersion（FCV） of 4.2并读取关注。也就是说，如果未启用FCV 或禁用了多数读功能，则启用的流控制无效。majority enabled4.2</span><br></pre></td></tr></table></figure>

<p><strong>自动故障转移</strong></p>
<p>当主节点与集合中的其他成员的通信<code>electionTimeoutMillis</code>时间超过配置的时间段（默认为10秒）时，合格的辅助节点将要求选举以提名自己为新的主节点。群集尝试完成新主数据库的选择并恢复正常操作。</p>
<p><img src="/" class="lazyload" data-src="http://cdn.linuxwf.com/img/mysql/mongodb04.png"  alt=""></p>
<h3 id="4-2-创建多实例副本集"><a href="#4-2-创建多实例副本集" class="headerlink" title="4.2 创建多实例副本集"></a>4.2 创建多实例副本集</h3><h4 id="1-创建节点目录和数据目录"><a href="#1-创建节点目录和数据目录" class="headerlink" title="1.创建节点目录和数据目录"></a>1.创建节点目录和数据目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/mongo_2801&#123;7,8,9&#125;/&#123;conf,logs,pid&#125;</span><br><span class="line">mkdir /data/mongo_2801&#123;7,8,9&#125; -p</span><br></pre></td></tr></table></figure>

<h4 id="2-创建配置文件"><a href="#2-创建配置文件" class="headerlink" title="2.创建配置文件"></a>2.创建配置文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;/opt/mongo_28017/conf/mongo_28017.conf &lt;&lt;EOF</span><br><span class="line">systemLog:</span><br><span class="line">  destination: file   </span><br><span class="line">  logAppend: <span class="literal">true</span>  </span><br><span class="line">  path: /opt/mongo_28017/logs/mongodb.log</span><br><span class="line"></span><br><span class="line">storage:</span><br><span class="line">  journal:</span><br><span class="line">    enabled: <span class="literal">true</span></span><br><span class="line">  dbPath: /data/mongo_28017</span><br><span class="line">  directoryPerDB: <span class="literal">true</span></span><br><span class="line">  wiredTiger:</span><br><span class="line">     engineConfig:</span><br><span class="line">        cacheSizeGB: 0.5 </span><br><span class="line">        directoryForIndexes: <span class="literal">true</span></span><br><span class="line">     collectionConfig:</span><br><span class="line">        blockCompressor: zlib</span><br><span class="line">     indexConfig:</span><br><span class="line">        prefixCompression: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">  fork: <span class="literal">true</span></span><br><span class="line">  pidFilePath: /opt/mongo_28017/pid/mongod.pid</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 28017</span><br><span class="line">  bindIp: 127.0.0.1,10.0.1.51</span><br><span class="line"></span><br><span class="line">replication:</span><br><span class="line">   oplogSizeMB: 1024 </span><br><span class="line">   replSetName: dba</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h4 id="3-复制配置文件到其他节点"><a href="#3-复制配置文件到其他节点" class="headerlink" title="3.复制配置文件到其他节点"></a>3.复制配置文件到其他节点</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /opt/mongo_28017/conf/mongo_28017.conf /opt/mongo_28018/conf/mongo_28018.conf</span><br><span class="line">cp /opt/mongo_28017/conf/mongo_28017.conf /opt/mongo_28019/conf/mongo_28019.conf</span><br></pre></td></tr></table></figure>

<h4 id="4-替换端口号"><a href="#4-替换端口号" class="headerlink" title="4.替换端口号"></a>4.替换端口号</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">'s#28017#28018#g'</span> /opt/mongo_28018/conf/mongo_28018.conf  </span><br><span class="line">sed -i <span class="string">'s#28017#28019#g'</span> /opt/mongo_28019/conf/mongo_28019.conf</span><br></pre></td></tr></table></figure>

<h4 id="5-启动所有节点"><a href="#5-启动所有节点" class="headerlink" title="5.启动所有节点"></a>5.启动所有节点</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mongod -f /opt/mongo_27017/conf/mongodb.conf --shutdown</span><br><span class="line">mongod -f /opt/mongo_28017/conf/mongo_28017.conf </span><br><span class="line">mongod -f /opt/mongo_28018/conf/mongo_28018.conf </span><br><span class="line">mongod -f /opt/mongo_28019/conf/mongo_28019.conf</span><br></pre></td></tr></table></figure>

<h4 id="6-初始化集群"><a href="#6-初始化集群" class="headerlink" title="6.初始化集群"></a>6.初始化集群</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mongo db01:28017</span><br><span class="line">config = &#123;</span><br><span class="line">	_id : <span class="string">"dba"</span>, </span><br><span class="line">	members : [</span><br><span class="line">		&#123;_id : 0, host : <span class="string">"db01:28017"</span>&#125;,</span><br><span class="line">		&#123;_id : 1, host : <span class="string">"db01:28018"</span>&#125;,</span><br><span class="line">		&#123;_id : 2, host : <span class="string">"db01:28019"</span>&#125;,</span><br><span class="line">	] </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rs.initiate(config) </span><br><span class="line"></span><br><span class="line">rs.status()  ---&gt; 查看状态</span><br></pre></td></tr></table></figure>

<h4 id="7-插入数据"><a href="#7-插入数据" class="headerlink" title="7.插入数据"></a>7.插入数据</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.insertMany( [</span><br><span class="line">    &#123; <span class="string">"item"</span>: <span class="string">"journal"</span>, <span class="string">"qty"</span>: 25, <span class="string">"size"</span>: &#123; <span class="string">"h"</span>: 14, <span class="string">"w"</span>: 21, <span class="string">"uom"</span>: <span class="string">"cm"</span> &#125;, <span class="string">"status"</span>: <span class="string">"A"</span> &#125;,</span><br><span class="line">    &#123; <span class="string">"item"</span>: <span class="string">"notebook"</span>, <span class="string">"qty"</span>: 50, <span class="string">"size"</span>: &#123; <span class="string">"h"</span>: 8.5, <span class="string">"w"</span>: 11, <span class="string">"uom"</span>: <span class="string">"in"</span> &#125;, <span class="string">"status"</span>: <span class="string">"A"</span> &#125;,</span><br><span class="line">    &#123; <span class="string">"item"</span>: <span class="string">"paper"</span>, <span class="string">"qty"</span>: 100, <span class="string">"size"</span>: &#123; <span class="string">"h"</span>: 8.5, <span class="string">"w"</span>: 11, <span class="string">"uom"</span>: <span class="string">"in"</span> &#125;, <span class="string">"status"</span>: <span class="string">"D"</span> &#125;,</span><br><span class="line">    &#123; <span class="string">"item"</span>: <span class="string">"planner"</span>, <span class="string">"qty"</span>: 75, <span class="string">"size"</span>: &#123; <span class="string">"h"</span>: 22.85, <span class="string">"w"</span>: 30, <span class="string">"uom"</span>: <span class="string">"cm"</span> &#125;, <span class="string">"status"</span>: <span class="string">"D"</span> &#125;,</span><br><span class="line">    &#123; <span class="string">"item"</span>: <span class="string">"postcard"</span>, <span class="string">"qty"</span>: 45, <span class="string">"size"</span>: &#123; <span class="string">"h"</span>: 10, <span class="string">"w"</span>: 15.25, <span class="string">"uom"</span>: <span class="string">"cm"</span> &#125;, <span class="string">"status"</span>: <span class="string">"A"</span> &#125;</span><br><span class="line"> ]);</span><br></pre></td></tr></table></figure>

<h4 id="8-副本节点登录查看数据"><a href="#8-副本节点登录查看数据" class="headerlink" title="8.副本节点登录查看数据"></a>8.副本节点登录查看数据</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mongo db01:28018</span><br><span class="line">rs.slaveOk();</span><br><span class="line">show dbs </span><br><span class="line">use <span class="built_in">test</span></span><br><span class="line">db.inventory.find()</span><br></pre></td></tr></table></figure>

<h4 id="9-设置副本可读"><a href="#9-设置副本可读" class="headerlink" title="9.设置副本可读"></a>9.设置副本可读</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"rs.slaveOk();"</span> &gt; /root/.mongorc.js</span><br></pre></td></tr></table></figure>

<h3 id="4-3-副本集权重调整"><a href="#4-3-副本集权重调整" class="headerlink" title="4.3 副本集权重调整"></a>4.3 副本集权重调整</h3><h4 id="1-查看当前副本集配置"><a href="#1-查看当前副本集配置" class="headerlink" title="1.查看当前副本集配置"></a>1.查看当前副本集配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rs.conf()</span><br></pre></td></tr></table></figure>

<h4 id="2-设置权重"><a href="#2-设置权重" class="headerlink" title="2.设置权重"></a>2.设置权重</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">config=rs.conf()</span><br><span class="line">config.members[0].priority=100</span><br><span class="line">rs.reconfig(config)</span><br></pre></td></tr></table></figure>

<h4 id="3-主节点主动降级"><a href="#3-主节点主动降级" class="headerlink" title="3.主节点主动降级"></a>3.主节点主动降级</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rs.stepDown()</span><br></pre></td></tr></table></figure>

<h3 id="4-4-增加新节点和删除旧节点"><a href="#4-4-增加新节点和删除旧节点" class="headerlink" title="4.4 增加新节点和删除旧节点"></a>4.4 增加新节点和删除旧节点</h3><h4 id="1-创建新节点并启动"><a href="#1-创建新节点并启动" class="headerlink" title="1.创建新节点并启动"></a>1.创建新节点并启动</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir /opt/mongo_28010/&#123;conf,logs,pid&#125; -p</span><br><span class="line">mkdir /data/mongo_28010</span><br><span class="line">cp /opt/mongo_28017/conf/mongo_28017.conf /opt/mongo_28010/conf/mongo_28010.conf</span><br><span class="line">sed -i <span class="string">'s#28017#28010#g'</span> /opt/mongo_28010/conf/mongo_28010.conf</span><br><span class="line">mongod -f /opt/mongo_28010/conf/mongo_28010.conf</span><br><span class="line">mongo db01:28010</span><br></pre></td></tr></table></figure>

<h4 id="2-集群添加节点"><a href="#2-集群添加节点" class="headerlink" title="2.集群添加节点"></a>2.集群添加节点</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rs.add(<span class="string">"db01:28010"</span>)</span><br></pre></td></tr></table></figure>

<h4 id="3-删除节点"><a href="#3-删除节点" class="headerlink" title="3.删除节点"></a>3.删除节点</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rs.remove(<span class="string">"db01:28010"</span>)</span><br></pre></td></tr></table></figure>

<h3 id="4-5-仲裁节点"><a href="#4-5-仲裁节点" class="headerlink" title="4.5 仲裁节点"></a>4.5 仲裁节点</h3><h4 id="1-创建新节点并启动-1"><a href="#1-创建新节点并启动-1" class="headerlink" title="1.创建新节点并启动"></a>1.创建新节点并启动</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir /opt/mongo_28011/&#123;conf,logs,pid&#125; -p</span><br><span class="line">mkdir /data/mongo_28011</span><br><span class="line">cp /opt/mongo_28017/conf/mongo_28017.conf /opt/mongo_28011/conf/mongo_28011.conf</span><br><span class="line">sed -i <span class="string">'s#28017#28011#g'</span> /opt/mongo_28011/conf/mongo_28011.conf</span><br><span class="line">mongod -f /opt/mongo_28011/conf/mongo_28011.conf</span><br><span class="line">mongo db01:28011</span><br></pre></td></tr></table></figure>

<h4 id="2-将仲裁节点加入集群"><a href="#2-将仲裁节点加入集群" class="headerlink" title="2.将仲裁节点加入集群"></a>2.将仲裁节点加入集群</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mongo db01:28018</span><br><span class="line">rs.addArb(<span class="string">"db01:28011"</span>)</span><br></pre></td></tr></table></figure>

<h2 id="第5章-mongo备份与恢复"><a href="#第5章-mongo备份与恢复" class="headerlink" title="第5章 mongo备份与恢复"></a>第5章 mongo备份与恢复</h2><h3 id="1-工具介绍"><a href="#1-工具介绍" class="headerlink" title="1.工具介绍"></a>1.工具介绍</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#（1）mongoexport/mongoimport</span></span><br><span class="line">mongoimport提供了一种获取JSON， CSV或TSV中的数据并将其导入mongod 实例的方法。mongoexport提供了一种将数据从mongod实例导出到JSON，CSV或TSV的方法。</span><br><span class="line"></span><br><span class="line"><span class="comment">#注意</span></span><br><span class="line">BSON与其他格式之间的转换缺乏完整的类型保真度。因此，您不能将mongoimport和 mongoexport用于往返导入和导出操作。</span><br><span class="line"><span class="comment">#（2）mongodump/mongorestore</span></span><br><span class="line">mongodump提供了一种 从实例创建BSON转储文件的方法mongod，同时 mongorestore还可以还原这些转储。bsondump将BSON转储文件转换为 JSON</span><br></pre></td></tr></table></figure>

<h3 id="2-应用场景"><a href="#2-应用场景" class="headerlink" title="2.应用场景"></a>2.应用场景</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.异构平台迁移  mysql &lt;---&gt; mongodb</span><br><span class="line">2.同平台，跨大版本：mongodb 2  ----&gt; mongodb 3</span><br><span class="line">mongoexport/mongoimport:json csv</span><br><span class="line"></span><br><span class="line">日常备份恢复时使用</span><br><span class="line">mongodump/mongorestore</span><br></pre></td></tr></table></figure>

<h3 id="3-导出工具mongoexport"><a href="#3-导出工具mongoexport" class="headerlink" title="3.导出工具mongoexport"></a>3.导出工具mongoexport</h3><p><strong>单表备份</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongoexport --port 27017 -d <span class="built_in">test</span> -c inventory -o /data/inventory.json</span><br></pre></td></tr></table></figure>

<p><strong>单表备份至csv格式</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mongoexport --port 27017 -d <span class="built_in">test</span> -c <span class="built_in">test</span> --<span class="built_in">type</span>=csv -f name,age,ad -o /data/test.csv</span><br><span class="line"><span class="comment">#说明：test目标数据库，第二个test目标集合，test.csv要保存的文件，--type指定导出的格式，默认是json，-f后面是需要导出的字段名称，多个字段名用逗号隔开</span></span><br></pre></td></tr></table></figure>

<h3 id="4-恢复"><a href="#4-恢复" class="headerlink" title="4.恢复"></a>4.恢复</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mongoimport --port 27017 -d <span class="built_in">test</span> -c inventory /data/inventory.json</span><br><span class="line"></span><br><span class="line">mongoimport --port 27017 -d <span class="built_in">test</span> -c <span class="built_in">test</span> --<span class="built_in">type</span>=csv --headerline --file  /data/test.csv</span><br><span class="line"><span class="comment"># 说明：test目标数据库，第二个test目标集合，test.csv要导入的文件，--type指定导出的格式，默认是json，--headerline批明不导入第一行</span></span><br></pre></td></tr></table></figure>

<h3 id="5-mysql数据迁移到mongo"><a href="#5-mysql数据迁移到mongo" class="headerlink" title="5.mysql数据迁移到mongo"></a>5.mysql数据迁移到mongo</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from world.city into outfile <span class="string">'/data/city2.csv'</span> fields terminated by <span class="string">','</span>;</span><br><span class="line">mongoimport --port 27017 -d world -c city --<span class="built_in">type</span>=csv --headerline --file  /data/city2.csv</span><br></pre></td></tr></table></figure>

<h3 id="6-导出与恢复"><a href="#6-导出与恢复" class="headerlink" title="6.导出与恢复"></a>6.导出与恢复</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mongodump  --port 27017 -o /data/backup</span><br><span class="line">mongorestore --port 27017 -d world  /data/backup/world/ --drop</span><br></pre></td></tr></table></figure>

<h3 id="7-模拟误删除恢复"><a href="#7-模拟误删除恢复" class="headerlink" title="7.模拟误删除恢复"></a>7.模拟误删除恢复</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">oplog</span><br><span class="line"></span><br><span class="line">db.oplog.rs.find().pretty()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"ts"</span> : Timestamp(1572983861, 1),</span><br><span class="line">	<span class="string">"t"</span> : NumberLong(13),</span><br><span class="line">	<span class="string">"h"</span> : NumberLong(<span class="string">"4118963721380445998"</span>),</span><br><span class="line">	<span class="string">"v"</span> : 2,</span><br><span class="line">	<span class="string">"op"</span> : <span class="string">"c"</span>,</span><br><span class="line">	<span class="string">"ns"</span> : <span class="string">"wo.<span class="variable">$cmd</span>"</span>,</span><br><span class="line">	<span class="string">"ui"</span> : UUID(<span class="string">"cb1848ae-8b34-4c76-b832-158324376723"</span>),</span><br><span class="line">	<span class="string">"wall"</span> : ISODate(<span class="string">"2019-11-05T19:57:41.679Z"</span>),</span><br><span class="line">	<span class="string">"o"</span> : &#123;</span><br><span class="line">		<span class="string">"drop"</span> : <span class="string">"ci"</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mongorestore --port 28017 --oplogReplay --oplogLimit <span class="string">"1572983861:1"</span> --drop  /data/backup/</span><br></pre></td></tr></table></figure>

<h3 id="8-Mongodump备份数据"><a href="#8-Mongodump备份数据" class="headerlink" title="8.Mongodump备份数据"></a>8.Mongodump备份数据</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mongodump -h dbhost -d dbname -o dbdirectory</span><br><span class="line"></span><br><span class="line"><span class="comment">#说明</span></span><br><span class="line">-h：MongDB所在服务器地址，例如：127.0.0.1，当然也可以指定端口号：127.0.0.1:27017</span><br><span class="line">-d：需要备份的数据库实例，例如：<span class="built_in">test</span></span><br><span class="line">-o：备份的数据存放位置，例如：c:\data\dump，当然该目录需要提前建立，在备份完成后，系统自动在dump目录下建立一个<span class="built_in">test</span>目录，这个目录里面存放该数据库实例的备份数据。</span><br></pre></td></tr></table></figure>

<h3 id="9-Mongorestore恢复数据"><a href="#9-Mongorestore恢复数据" class="headerlink" title="9.Mongorestore恢复数据"></a>9.Mongorestore恢复数据</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mongorestore -h dbhost -d dbname -directoryperdb dbdirectory</span><br><span class="line"></span><br><span class="line"><span class="comment">#说明</span></span><br><span class="line">-h：MongoDB所在服务器地址</span><br><span class="line">-d：需要恢复的数据库实例，例如：<span class="built_in">test</span>，当然这个名称也可以和备份时候的不一样，比如test2</span><br><span class="line">-directoryperdb：备份数据所在位置，例如：c:\data\dump\<span class="built_in">test</span></span><br></pre></td></tr></table></figure>

</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Wu Fei</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://linuxwf.com/2020/04/15/Mongo%E5%91%BD%E4%BB%A4%E4%B8%8E%E5%89%AF%E6%9C%AC%E9%9B%86/">http://linuxwf.com/2020/04/15/Mongo%E5%91%BD%E4%BB%A4%E4%B8%8E%E5%89%AF%E6%9C%AC%E9%9B%86/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://linuxwf.com" target="_blank">WF's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MongoDB/">MongoDB</a></div><div class="post_share"><div class="social-share" data-image="/img/wallhaven-630117.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付宝"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/04/15/1-shell%E7%BC%96%E7%A8%8B%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%8F%98%E9%87%8F/"><img class="prev_cover lazyload" data-src="/img/wallhaven-264945.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">1.shell编程介绍及变量</div></div></a></div><div class="next-post pull_right"><a href="/2020/04/15/Mongodb%E4%BB%8B%E7%BB%8D%E5%AE%89%E8%A3%85/"><img class="next_cover lazyload" data-src="/img/wallhaven-2714.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Mongodb介绍安装</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/04/15/Mongodb介绍安装/" title="Mongodb介绍安装"><img class="relatedPosts_cover lazyload"data-src="/img/wallhaven-2714.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-15</div><div class="relatedPosts_title">Mongodb介绍安装</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify: true,
  verify: false,
  appId: 'mJGbzahn0dOntrhO5Hek8Rjd-gzGzoHsz',
  appKey: 'b0O75eIR8ULkl2kyDWLgLXM0',
  placeholder: 'Please leave your footprints',
  avatar: 'monsterid',
  meta: guest_info,
  pageSize: '10',
  lang: 'zh-cn',
  recordIP: false,
  serverURLs: ''
});</script></div></article></main><footer id="footer" style="background-image: url(/img/wallhaven-153272.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By Wu Fei</div><div class="footer_custom_text">Hi, welcome to my <a href="https://www.linuxwf.com/" target="_blank" rel="noopener">blog</a></div><div class="icp"><a href="http://beian.miit.gov.cn" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"/><span>粤ICP备19138449号-1</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode far fa-moon" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/search/algolia.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":100,"vOffset":-50},"mobile":{"show":true,"scale":0.5}});</script></body></html>