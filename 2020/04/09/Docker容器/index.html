<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Docker容器 | WF's Blog</title><meta name="description" content="Docker容器"><meta name="keywords" content="dokcer"><meta name="author" content="Wu Fei"><meta name="copyright" content="Wu Fei"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://hm.baidu.com"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Docker容器"><meta name="twitter:description" content="Docker容器"><meta name="twitter:image" content="http://linuxwf.com/img/wallhaven-153272.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Docker容器"><meta property="og:url" content="http://linuxwf.com/2020/04/09/Docker%E5%AE%B9%E5%99%A8/"><meta property="og:site_name" content="WF's Blog"><meta property="og:description" content="Docker容器"><meta property="og:image" content="http://linuxwf.com/img/wallhaven-153272.jpg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="http://linuxwf.com/2020/04/09/Docker%E5%AE%B9%E5%99%A8/"><link rel="prev" title="第1章 k8s简介" href="http://linuxwf.com/2020/04/09/%E7%AC%AC1%E7%AB%A0-k8s%E7%AE%80%E4%BB%8B/"><link rel="next" title="Hexo搜索插件" href="http://linuxwf.com/2020/04/09/Hexo%E6%90%9C%E7%B4%A2%E6%8F%92%E4%BB%B6/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?bf8fa809dbe0a82b3d983accb9d256fe";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"GQXJKQPX6A","apiKey":"9d6901decfc3e9736a8f99965d4fc700","indexName":"my_blog","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: true,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="WF's Blog" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">23</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">12</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">5</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 娱乐</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/video/"><i class="fa-fw fa fa-video"></i><span> 视频</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fa fa-book"></i><span> 书籍</span></a></li><li><a class="site-page" href="/games/"><i class="fa-fw fa fa-gamepad"></i><span> Game</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker容器"><span class="toc-number">1.</span> <span class="toc-text">Docker容器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-容器介绍"><span class="toc-number">1.1.</span> <span class="toc-text">Docker 容器介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-是什么"><span class="toc-number">1.1.1.</span> <span class="toc-text">docker 是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#namespace-命名空间"><span class="toc-number">1.1.2.</span> <span class="toc-text">namespace 命名空间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cgroups资源限制"><span class="toc-number">1.1.3.</span> <span class="toc-text">cgroups资源限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#容器与虚拟机对比"><span class="toc-number">1.1.4.</span> <span class="toc-text">容器与虚拟机对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-的三个重要概念"><span class="toc-number">1.1.5.</span> <span class="toc-text">docker 的三个重要概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-的组成部分"><span class="toc-number">1.1.6.</span> <span class="toc-text">docker 的组成部分</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-安装部署"><span class="toc-number">1.2.</span> <span class="toc-text">Docker 安装部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#国内源安装docker-ce"><span class="toc-number">1.2.1.</span> <span class="toc-text">国内源安装docker-ce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#国内远镜像加速配置"><span class="toc-number">1.2.2.</span> <span class="toc-text">国内远镜像加速配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#快速安装"><span class="toc-number">1.2.3.</span> <span class="toc-text">快速安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#运行第一个容器"><span class="toc-number">1.2.4.</span> <span class="toc-text">运行第一个容器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-镜像和容器管理"><span class="toc-number">1.3.</span> <span class="toc-text">Docker 镜像和容器管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#镜像相关命令"><span class="toc-number">1.3.1.</span> <span class="toc-text">镜像相关命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#搜索镜像"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">搜索镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#获取镜像"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">获取镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看镜像"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">查看镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#删除镜像"><span class="toc-number">1.3.1.4.</span> <span class="toc-text">删除镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#导出镜像"><span class="toc-number">1.3.1.5.</span> <span class="toc-text">导出镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#导入镜像"><span class="toc-number">1.3.1.6.</span> <span class="toc-text">导入镜像</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#容器相关命令"><span class="toc-number">1.3.2.</span> <span class="toc-text">容器相关命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#启动容器"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">启动容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#停止容器"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">停止容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看容器的详细信息"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">查看容器的详细信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看正在运行和已经停止的容器"><span class="toc-number">1.3.2.4.</span> <span class="toc-text">查看正在运行和已经停止的容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#进入容器"><span class="toc-number">1.3.2.5.</span> <span class="toc-text">进入容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#删除容器"><span class="toc-number">1.3.2.6.</span> <span class="toc-text">删除容器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-网络管理"><span class="toc-number">1.4.</span> <span class="toc-text">Docker 网络管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#随机映射端口"><span class="toc-number">1.4.1.</span> <span class="toc-text">随机映射端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#指定映射端口"><span class="toc-number">1.4.2.</span> <span class="toc-text">指定映射端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#跨主机通信"><span class="toc-number">1.4.3.</span> <span class="toc-text">跨主机通信</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-数据卷管理"><span class="toc-number">1.5.</span> <span class="toc-text">Docker 数据卷管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#持久化数据卷"><span class="toc-number">1.5.1.</span> <span class="toc-text">持久化数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建游戏代码目录"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">创建游戏代码目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建容器并映射数据卷"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">创建容器并映射数据卷</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#访问游戏页面"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">访问游戏页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#持久化数据卷容器"><span class="toc-number">1.5.2.</span> <span class="toc-text">持久化数据卷容器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建一个容器卷"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">创建一个容器卷</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看卷的目录"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">查看卷的目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#复制代码目录到容器卷目录"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">复制代码目录到容器卷目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用容器卷创建新容器"><span class="toc-number">1.5.2.4.</span> <span class="toc-text">使用容器卷创建新容器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实验-访问不同端口展示不同页面"><span class="toc-number">1.5.3.</span> <span class="toc-text">实验-访问不同端口展示不同页面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#准备nginx-配置文件"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">准备nginx 配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#上传代码目录"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">上传代码目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建容器并挂载"><span class="toc-number">1.5.3.3.</span> <span class="toc-text">创建容器并挂载</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-镜像手动构建"><span class="toc-number">1.6.</span> <span class="toc-text">Docker 镜像手动构建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#手动制作游戏镜像"><span class="toc-number">1.6.1.</span> <span class="toc-text">手动制作游戏镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#启动一个容器并安装nginx"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">启动一个容器并安装nginx</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#上传代码目录并配置nginx-配置文件"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">上传代码目录并配置nginx 配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#将容器提交为新的镜像"><span class="toc-number">1.6.1.3.</span> <span class="toc-text">将容器提交为新的镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#测试镜像功能是否可用"><span class="toc-number">1.6.1.4.</span> <span class="toc-text">测试镜像功能是否可用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#将新镜像导出"><span class="toc-number">1.6.1.5.</span> <span class="toc-text">将新镜像导出</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#手动制作云盘镜像"><span class="toc-number">1.6.2.</span> <span class="toc-text">手动制作云盘镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建容器"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">创建容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#进入容器安装php-并求改运行用户"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">进入容器安装php 并求改运行用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置nginx"><span class="toc-number">1.6.2.3.</span> <span class="toc-text">配置nginx</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#下载代码目录"><span class="toc-number">1.6.2.4.</span> <span class="toc-text">下载代码目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#容器启动脚本命令"><span class="toc-number">1.6.2.5.</span> <span class="toc-text">容器启动脚本命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#提交新的镜像"><span class="toc-number">1.6.2.6.</span> <span class="toc-text">提交新的镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动测试"><span class="toc-number">1.6.2.7.</span> <span class="toc-text">启动测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#访问测试"><span class="toc-number">1.6.2.8.</span> <span class="toc-text">访问测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dockerfile-自动构建Docker-镜像"><span class="toc-number">1.7.</span> <span class="toc-text">Dockerfile 自动构建Docker 镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Dockerfile-操作命令说明"><span class="toc-number">1.7.1.</span> <span class="toc-text">Dockerfile 操作命令说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用Dockerfile-创建基础系统镜像"><span class="toc-number">1.7.2.</span> <span class="toc-text">使用Dockerfile 创建基础系统镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用Dockerfile-创建云盘"><span class="toc-number">1.7.3.</span> <span class="toc-text">使用Dockerfile 创建云盘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#准备需要的文件"><span class="toc-number">1.7.3.1.</span> <span class="toc-text">准备需要的文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#编写dockerfile"><span class="toc-number">1.7.3.2.</span> <span class="toc-text">编写dockerfile</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#构建新镜像"><span class="toc-number">1.7.3.3.</span> <span class="toc-text">构建新镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#基于新镜像运行容器"><span class="toc-number">1.7.3.4.</span> <span class="toc-text">基于新镜像运行容器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-私有仓库"><span class="toc-number">1.8.</span> <span class="toc-text">Docker 私有仓库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#企业级的docker-harbor"><span class="toc-number">1.8.1.</span> <span class="toc-text">企业级的docker-harbor</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#部署思路"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">部署思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装"><span class="toc-number">1.8.1.2.</span> <span class="toc-text">安装</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker运行zabbix"><span class="toc-number">1.9.</span> <span class="toc-text">docker运行zabbix</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker运行gitlab"><span class="toc-number">1.10.</span> <span class="toc-text">docker运行gitlab</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(/img/wallhaven-153272.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">WF's Blog</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 娱乐</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/video/"><i class="fa-fw fa fa-video"></i><span> 视频</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fa fa-book"></i><span> 书籍</span></a></li><li><a class="site-page" href="/games/"><i class="fa-fw fa fa-gamepad"></i><span> Game</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Docker容器</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-04-09 15:16:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-04-09</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-04-09 15:37:05"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-04-09</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Docker%E5%AE%B9%E5%99%A8/">Docker容器</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon far fa-file-word" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">4.5k</span><span class="post-meta__separator">|</span><i class="post-meta__icon far fa-clock" aria-hidden="true"></i><span>阅读时长: 19 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon far fa-comments" aria-hidden="true"></i><span>评论数:</span><a href="/2020/04/09/Docker%E5%AE%B9%E5%99%A8/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2020/04/09/Docker%E5%AE%B9%E5%99%A8/" itemprop="commentCount"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h1 id="Docker容器"><a href="#Docker容器" class="headerlink" title="Docker容器"></a>Docker容器</h1><h2 id="Docker-容器介绍"><a href="#Docker-容器介绍" class="headerlink" title="Docker 容器介绍"></a>Docker 容器介绍</h2><h3 id="docker-是什么"><a href="#docker-是什么" class="headerlink" title="docker 是什么"></a>docker 是什么</h3><p>Docker 是Docker.Inc 公司开源的一个基于LXC 技术之上构建的Container 容器引擎， 源代码托管<br>在GitHub 上, 基于Go 语言并遵从Apache2.0 协议开源。<br>Docker 是通过内核虚拟化技术（namespaces 及cgroups 等）来提供容器的资源隔离与安全保障等。由于Docker 通过操作系统层的虚拟化实现隔离，所以Docker 容器在运行时，不需要类似虚拟机（VM）额外的操作系统开销，提高资源利用率。</p>
<h3 id="namespace-命名空间"><a href="#namespace-命名空间" class="headerlink" title="namespace 命名空间"></a>namespace 命名空间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Mount Namespace - 用于隔离文件系统的挂载点</span><br><span class="line">UTS Namespace - 用于隔离HostName 和DomianName</span><br><span class="line">IPC Namespace - 用于隔离进程间通信</span><br><span class="line">PID Namespace - 用于隔离进程ID</span><br><span class="line">Network Namespace - 用于隔离网络</span><br><span class="line">User Namespace - 用于隔离用户和用户组UID/GID</span><br></pre></td></tr></table></figure>

<h3 id="cgroups资源限制"><a href="#cgroups资源限制" class="headerlink" title="cgroups资源限制"></a>cgroups资源限制</h3><p>控制组（cgroups）是Linux 内核的一个特性，主要用来对共享资源进行隔离、限制、审计等。只有<br>能控制分配到容器的资源，才能避免当多个容器同时运行时的对系统资源的竞争。<br>控制组技术最早是由Google 的程序员在2006 年提出，Linux 内核自2.6.24 开始支持。<br>控制组可以提供对容器的内存、CPU、磁盘IO 等资源的限制和审计管理。</p>
<h3 id="容器与虚拟机对比"><a href="#容器与虚拟机对比" class="headerlink" title="容器与虚拟机对比"></a>容器与虚拟机对比</h3><p><img src="/" class="lazyload" data-src="https://note.youdao.com/yws/public/resource/f681b4611780d72ab9718e381df5ea17/58F195B98CB741CF97EB5AFA4076F8B3?ynotemdtimestamp=1586417471888"  alt="image"></p>
<p><img src="/" class="lazyload" data-src="https://note.youdao.com/yws/public/resource/f681b4611780d72ab9718e381df5ea17/2136579F0E664FB38DE98440F203F638?ynotemdtimestamp=1586417471888"  alt="image"></p>
<h3 id="docker-的三个重要概念"><a href="#docker-的三个重要概念" class="headerlink" title="docker 的三个重要概念"></a>docker 的三个重要概念</h3><p><strong>Image(镜像):</strong><br>那么镜像到底是什么呢？Docker 镜像可以看作是一个特殊的文件系统，除了提供容器运行时所需的<br>程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。</p>
<p><strong>Container(容器)</strong><br>容器(Container)的定义和镜像(Image)几乎一模一样，也是一堆层的统一视角，唯一区别在于容器的最上面那一层是可读可写的。</p>
<p><strong>Repository(仓库)</strong><br>镜像仓库是Docker 用来集中存放镜像文件的地方，类似于我们之前常用的代码仓库。<br>通常，一个仓库会包含同一个软件不同版本的镜像，而标签就常用于对应该软件的各个版本。<br>我们可以通过&lt;仓库名&gt;:&lt;标签&gt;的格式来指定具体是这个软件哪个版本的镜像。如果不给出标签，将<br>以Latest 作为默认标签。</p>
<p><img src="/" class="lazyload" data-src="https://note.youdao.com/yws/public/resource/f681b4611780d72ab9718e381df5ea17/797B5B7220C249E29DA22FF643FE4198?ynotemdtimestamp=1586417471888"  alt="image"></p>
<h3 id="docker-的组成部分"><a href="#docker-的组成部分" class="headerlink" title="docker 的组成部分"></a>docker 的组成部分</h3><p>docker 是传统的CS 架构分为docker client 和docker server<br>Docker 客户端是Docker 用户与Docker 交互的主要方式。当您使用Docker 命令行运行命令时，<br>Docker 客户端将这些命令发送给服务器端，服务端将执行这些命令。<br>Docker 命令使用Docker API 。Docker 客户端可以与多个服务端进行通信。</p>
<p><img src="/" class="lazyload" data-src="https://note.youdao.com/yws/public/resource/f681b4611780d72ab9718e381df5ea17/1EF6422FF8044852AFE47F294CD6B928?ynotemdtimestamp=1586417471888"  alt="image"></p>
<h2 id="Docker-安装部署"><a href="#Docker-安装部署" class="headerlink" title="Docker 安装部署"></a>Docker 安装部署</h2><h3 id="国内源安装docker-ce"><a href="#国内源安装docker-ce" class="headerlink" title="国内源安装docker-ce"></a>国内源安装docker-ce</h3><p>这里我们使用清华源：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://mirrors.tuna.tsinghua.edu.cn/<span class="built_in">help</span>/docker-ce/</span><br></pre></td></tr></table></figure>

<p>操作步骤：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum remove docker docker-common docker-selinux docker-engine</span><br><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">wget -O /etc/yum.repos.d/docker-ce.repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">sed -i <span class="string">'s+download.docker.com+mirrors.tuna.tsinghua.edu.cn/docker-ce+'</span> /etc/yum.repos.d/docker-ce.repo</span><br><span class="line">yum makecache fast</span><br><span class="line">yum install docker-ce</span><br><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>

<h3 id="国内远镜像加速配置"><a href="#国内远镜像加速配置" class="headerlink" title="国内远镜像加速配置"></a>国内远镜像加速配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /etc/docker</span><br><span class="line"> tee /etc/docker/daemon.json &lt;&lt;-<span class="string">'EOF'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"registry-mirrors"</span>: [<span class="string">"https://1660dchq.mirror.aliyuncs.com"</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<h3 id="快速安装"><a href="#快速安装" class="headerlink" title="快速安装"></a>快速安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">思路：</span><br><span class="line">1.开启yum 缓存</span><br><span class="line">2.全新环境安装docker</span><br><span class="line">3.将缓存的包全部打包出来</span><br><span class="line">4.安装的时候使用rpm -ivh *.rpm 方式安装</span><br></pre></td></tr></table></figure>

<h3 id="运行第一个容器"><a href="#运行第一个容器" class="headerlink" title="运行第一个容器"></a>运行第一个容器</h3><p>运行一个Hello world</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run alpine /bin/<span class="built_in">echo</span> <span class="string">"Hello world"</span></span><br></pre></td></tr></table></figure>

<h2 id="Docker-镜像和容器管理"><a href="#Docker-镜像和容器管理" class="headerlink" title="Docker 镜像和容器管理"></a>Docker 镜像和容器管理</h2><h3 id="镜像相关命令"><a href="#镜像相关命令" class="headerlink" title="镜像相关命令"></a>镜像相关命令</h3><h4 id="搜索镜像"><a href="#搜索镜像" class="headerlink" title="搜索镜像"></a>搜索镜像</h4><p>选择镜像建议：</p>
<p>1.优先选择官方的</p>
<p>2.选择星星多的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search centos</span><br></pre></td></tr></table></figure>

<p>3.搜索镜像并查看该镜像的tag</p>
<p>默认我们使用命令查看是看不到镜像的版本的，可以通过docker-hub 查看，但是国内原因。。。<br>这里可以使用仓库的restful APIl 来查询<br>jq 是一个json 格式化工具，需要提前安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install jq -y</span><br><span class="line">curl -s https://registry.hub.docker.com/v1/repositories/centos/tags|jq</span><br></pre></td></tr></table></figure>

<h4 id="获取镜像"><a href="#获取镜像" class="headerlink" title="获取镜像"></a>获取镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos:7</span><br></pre></td></tr></table></figure>

<h4 id="查看镜像"><a href="#查看镜像" class="headerlink" title="查看镜像"></a>查看镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<h4 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi centos:7</span><br></pre></td></tr></table></figure>

<h4 id="导出镜像"><a href="#导出镜像" class="headerlink" title="导出镜像"></a>导出镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker save centos:7 -o centos-v7.tar</span><br><span class="line">docker save centos:7 &gt; centos-v7.tar</span><br></pre></td></tr></table></figure>

<h4 id="导入镜像"><a href="#导入镜像" class="headerlink" title="导入镜像"></a>导入镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker load -i centos-v7.tar</span><br><span class="line">docker load &lt; centos-v7.tar</span><br></pre></td></tr></table></figure>

<h3 id="容器相关命令"><a href="#容器相关命令" class="headerlink" title="容器相关命令"></a>容器相关命令</h3><h4 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.启动一个容器并保持不退出</span><br><span class="line">docker run -it -d centos:7 /bin/bash </span><br><span class="line">2.启动一个容器并保持不退出并自定义命名</span><br><span class="line">docker run --name mycentos -it -d centos:7 /bin/bash</span><br></pre></td></tr></table></figure>

<h4 id="停止容器"><a href="#停止容器" class="headerlink" title="停止容器"></a>停止容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop 容器ID</span><br></pre></td></tr></table></figure>

<h4 id="查看容器的详细信息"><a href="#查看容器的详细信息" class="headerlink" title="查看容器的详细信息"></a>查看容器的详细信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect 容器名或ID</span><br></pre></td></tr></table></figure>

<h4 id="查看正在运行和已经停止的容器"><a href="#查看正在运行和已经停止的容器" class="headerlink" title="查看正在运行和已经停止的容器"></a>查看正在运行和已经停止的容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br><span class="line">docker ps -a</span><br><span class="line">docker ps -q</span><br><span class="line">docker ps -qa</span><br></pre></td></tr></table></figure>

<h4 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a>进入容器</h4><p>docker exec 会分配一个新的终端tty</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.docker <span class="built_in">exec</span> 会分配一个新的终端tty</span><br><span class="line">docker <span class="built_in">exec</span> -it 容器ID /bin/bash</span><br><span class="line">2.docker attach 会使用同一个终端</span><br><span class="line">docker attach 容器ID</span><br></pre></td></tr></table></figure>

<h4 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h4><p>删除单个容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm 容器ID</span><br></pre></td></tr></table></figure>

<p>批量删除容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker stop $(docker ps -q)</span><br><span class="line">docker rm $(docker ps -aq)</span><br></pre></td></tr></table></figure>

<h2 id="Docker-网络管理"><a href="#Docker-网络管理" class="headerlink" title="Docker 网络管理"></a>Docker 网络管理</h2><h3 id="随机映射端口"><a href="#随机映射端口" class="headerlink" title="随机映射端口"></a>随机映射端口</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -P -d nginx:latest</span><br></pre></td></tr></table></figure>

<h3 id="指定映射端口"><a href="#指定映射端口" class="headerlink" title="指定映射端口"></a>指定映射端口</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 8080:80 -d nginx:latest</span><br></pre></td></tr></table></figure>

<p>如果想多个容器使用8080 端口，可以通过添加多个IP 地址实现</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ifconfig eth0:1 10.0.1.52 up</span><br><span class="line">docker run -d -p 10.0.1.51:8080:80 nginx:latest</span><br><span class="line">docker run -d -p 10.0.1.52:8080:80 nginx:latest</span><br></pre></td></tr></table></figure>

<p>进入容器里修改站点目录，然后访问测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it bdb2a4e7e24d /bin/bash</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"web01"</span> &gt; /usr/share/nginx/html/index.html</span><br><span class="line">docker <span class="built_in">exec</span> -it 31c1de138dda /bin/bash</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"web02"</span> &gt; /usr/share/nginx/html/index.html</span><br></pre></td></tr></table></figure>

<p>访问测试：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># curl 10.0.1.51:8080</span></span><br></pre></td></tr></table></figure>

<h3 id="跨主机通信"><a href="#跨主机通信" class="headerlink" title="跨主机通信"></a>跨主机通信</h3><h2 id="Docker-数据卷管理"><a href="#Docker-数据卷管理" class="headerlink" title="Docker 数据卷管理"></a>Docker 数据卷管理</h2><h3 id="持久化数据卷"><a href="#持久化数据卷" class="headerlink" title="持久化数据卷"></a>持久化数据卷</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-v 宿主机目录:容器内目录</span><br></pre></td></tr></table></figure>

<p>下面我们来创建一个html5 小游戏</p>
<h4 id="创建游戏代码目录"><a href="#创建游戏代码目录" class="headerlink" title="创建游戏代码目录"></a>创建游戏代码目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data/ -p</span><br><span class="line"><span class="built_in">cd</span> /data/</span><br><span class="line">unzip xiaoniaofeifei.zip -d xiaoniao</span><br></pre></td></tr></table></figure>

<h4 id="创建容器并映射数据卷"><a href="#创建容器并映射数据卷" class="headerlink" title="创建容器并映射数据卷"></a>创建容器并映射数据卷</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker stop $(docker ps -q)</span><br><span class="line">docker rm $(docker ps -aq)</span><br><span class="line">docker run -d -p 80:80 -v /data/xiaoniao:/usr/share/nginx/html nginx:latest</span><br><span class="line">docker ps</span><br></pre></td></tr></table></figure>

<h4 id="访问游戏页面"><a href="#访问游戏页面" class="headerlink" title="访问游戏页面"></a>访问游戏页面</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.0.1.51</span><br></pre></td></tr></table></figure>

<h3 id="持久化数据卷容器"><a href="#持久化数据卷容器" class="headerlink" title="持久化数据卷容器"></a>持久化数据卷容器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--volumes-from (跟某一个已经存在的容器挂载相同的卷)</span><br></pre></td></tr></table></figure>

<p>查看当前容器有哪些卷</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume ls</span><br></pre></td></tr></table></figure>

<p>下面我们利用容器卷创建一个小游戏</p>
<h4 id="创建一个容器卷"><a href="#创建一个容器卷" class="headerlink" title="创建一个容器卷"></a>创建一个容器卷</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8080:80 --volume xiaoniao:/usr/share/nginx/html nginx:latest</span><br><span class="line">docker volume ls</span><br></pre></td></tr></table></figure>

<h4 id="查看卷的目录"><a href="#查看卷的目录" class="headerlink" title="查看卷的目录"></a>查看卷的目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume inspect xiaoniao</span><br></pre></td></tr></table></figure>

<h4 id="复制代码目录到容器卷目录"><a href="#复制代码目录到容器卷目录" class="headerlink" title="复制代码目录到容器卷目录"></a>复制代码目录到容器卷目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\cp -a /data/xiaoniao/* /var/lib/docker/volumes/xiaoniao/_data/</span><br></pre></td></tr></table></figure>

<h4 id="使用容器卷创建新容器"><a href="#使用容器卷创建新容器" class="headerlink" title="使用容器卷创建新容器"></a>使用容器卷创建新容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8090:80 --volume xiaoniao:/usr/share/nginx/html nginx:latest</span><br></pre></td></tr></table></figure>

<h3 id="实验-访问不同端口展示不同页面"><a href="#实验-访问不同端口展示不同页面" class="headerlink" title="实验-访问不同端口展示不同页面"></a>实验-访问不同端口展示不同页面</h3><p>需求：<br>访问8080 端口，展示xiaoniao 首页<br>访问8090 端口，展示游戏集合页面</p>
<h4 id="准备nginx-配置文件"><a href="#准备nginx-配置文件" class="headerlink" title="准备nginx 配置文件"></a>准备nginx 配置文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;/data/game.conf&lt;&lt;EOF</span><br><span class="line">server &#123;</span><br><span class="line">    listen       8080;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root   /opt/game/;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       8090;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root   /opt/xiaoniao/;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h4 id="上传代码目录"><a href="#上传代码目录" class="headerlink" title="上传代码目录"></a>上传代码目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 /data]<span class="comment"># ll</span></span><br><span class="line">总用量18896</span><br><span class="line">drwxr-xr-x 5 root root 73 9 月7 23:03 game</span><br><span class="line">-rw-r--r-- 1 root root 309 9 月7 22:57 game.conf</span><br><span class="line">-rw-r--r-- 1 root root 19248295 8 月28 09:48 html5.zip</span><br><span class="line">drwxr-xr-x 3 root root 92 9 月7 22:15 xiaoniao</span><br><span class="line">-rw-r--r-- 1 root root 91014 9 月7 22:11 xiaoniaofeifei.zip</span><br></pre></td></tr></table></figure>

<h4 id="创建容器并挂载"><a href="#创建容器并挂载" class="headerlink" title="创建容器并挂载"></a>创建容器并挂载</h4><p>需要挂载的内容：<br>1.nginx 配置文件<br>2.游戏目录<br>创建容器命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker stop $(docker ps -q)</span><br><span class="line">docker rm $(docker ps -aq)</span><br><span class="line">docker run -d -p 8080:8080 -p 8090:8090 -v /data/xiaoniao:/opt/xiaoniao -v /data/game:/opt/game -v /data/game.conf:/etc/nginx/conf.d/game.conf nginx:latest</span><br><span class="line">docker ps</span><br></pre></td></tr></table></figure>

<h2 id="Docker-镜像手动构建"><a href="#Docker-镜像手动构建" class="headerlink" title="Docker 镜像手动构建"></a>Docker 镜像手动构建</h2><h3 id="手动制作游戏镜像"><a href="#手动制作游戏镜像" class="headerlink" title="手动制作游戏镜像"></a>手动制作游戏镜像</h3><p>下面我们基于centos 容器制作一个新镜像，并安装nginx 服务</p>
<h4 id="启动一个容器并安装nginx"><a href="#启动一个容器并安装nginx" class="headerlink" title="启动一个容器并安装nginx"></a>启动一个容器并安装nginx</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">docker run -it centos:7 /bin/bash</span><br><span class="line">yum install wget install openssh-clients -y</span><br><span class="line">rm -rf /etc/yum.repos.d/*</span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line">sed -i -e <span class="string">'/mirrors.cloud.aliyuncs.com/d'</span> -e <span class="string">'/mirrors.aliyuncs.com/d'</span> /etc/yum.repos.d/CentOS-Base.repo</span><br><span class="line">cat &gt;/etc/yum.repos.d/nginx.repo&lt;&lt;EOF  </span><br><span class="line">[nginx-stable]</span><br><span class="line">name=nginx stable repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/\<span class="variable">$releasever</span>/\<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">[nginx-mainline]</span><br><span class="line">name=nginx mainline repo</span><br><span class="line">baseurl=http://nginx.org/packages/mainline/centos/\<span class="variable">$releasever</span>/\<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">EOF</span><br><span class="line">yum makecache fast</span><br><span class="line">yum install nginx -y</span><br></pre></td></tr></table></figure>

<h4 id="上传代码目录并配置nginx-配置文件"><a href="#上传代码目录并配置nginx-配置文件" class="headerlink" title="上传代码目录并配置nginx 配置文件"></a>上传代码目录并配置nginx 配置文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp -r 10.0.1.51:/data/* /opt/</span><br><span class="line">mv /opt/game.conf /etc/nginx/conf.d/</span><br></pre></td></tr></table></figure>

<h4 id="将容器提交为新的镜像"><a href="#将容器提交为新的镜像" class="headerlink" title="将容器提交为新的镜像"></a>将容器提交为新的镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br><span class="line">docker commit 容器ID game:v1</span><br><span class="line">docker images</span><br></pre></td></tr></table></figure>

<h4 id="测试镜像功能是否可用"><a href="#测试镜像功能是否可用" class="headerlink" title="测试镜像功能是否可用"></a>测试镜像功能是否可用</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 8080:8080 -p 8090:8090 -d game:v1 nginx -g <span class="string">'daemon off;'</span></span><br></pre></td></tr></table></figure>

<h4 id="将新镜像导出"><a href="#将新镜像导出" class="headerlink" title="将新镜像导出"></a>将新镜像导出</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker save game:v1 &gt; game-v1.tar</span><br><span class="line">docker load &lt; game-v1.tar</span><br></pre></td></tr></table></figure>

<h3 id="手动制作云盘镜像"><a href="#手动制作云盘镜像" class="headerlink" title="手动制作云盘镜像"></a>手动制作云盘镜像</h3><h4 id="创建容器"><a href="#创建容器" class="headerlink" title="创建容器"></a>创建容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 80:80 --name clould game:v1 nginx -g <span class="string">'daemon off;'</span></span><br></pre></td></tr></table></figure>

<h4 id="进入容器安装php-并求改运行用户"><a href="#进入容器安装php-并求改运行用户" class="headerlink" title="进入容器安装php 并求改运行用户"></a>进入容器安装php 并求改运行用户</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">yum install wget install openssh-clients unzip -y</span><br><span class="line">rm -rf /etc/yum.repos.d/*</span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line">sed -i -e <span class="string">'/mirrors.cloud.aliyuncs.com/d'</span> -e <span class="string">'/mirrors.aliyuncs.com/d'</span> /etc/yum.repos.d/CentOS-Base.repo</span><br><span class="line">cat &gt;/etc/yum.repos.d/nginx.repo&lt;&lt;EOF  </span><br><span class="line">[nginx-stable]</span><br><span class="line">name=nginx stable repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/\<span class="variable">$releasever</span>/\<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">[nginx-mainline]</span><br><span class="line">name=nginx mainline repo</span><br><span class="line">baseurl=http://nginx.org/packages/mainline/centos/\<span class="variable">$releasever</span>/\<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">EOF</span><br><span class="line">yum makecache fast</span><br><span class="line">yum install nginx php-fpm php-mbstring php-gd -y</span><br><span class="line">sed -i <span class="string">'/^user/c user = nginx'</span> /etc/php-fpm.d/www.conf</span><br><span class="line">sed -i <span class="string">'/^group/c group = nginx'</span> /etc/php-fpm.d/www.conf</span><br><span class="line">sed -i <span class="string">'/daemonize/s#no#yes#g'</span> /etc/php-fpm.conf     </span><br><span class="line">php-fpm -c /etc/php.ini -y /etc/php-fpm.conf</span><br><span class="line">ps -ef|grep php</span><br></pre></td></tr></table></figure>

<h4 id="配置nginx"><a href="#配置nginx" class="headerlink" title="配置nginx"></a>配置nginx</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cat&gt; /etc/nginx/conf.d/cloud.conf &lt;&lt;EOF  </span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name localhost;</span><br><span class="line">    root /code/kod;</span><br><span class="line">    index index.php index.html;</span><br><span class="line"></span><br><span class="line">    location ~ \.php\$ &#123;</span><br><span class="line">        root /code/kod;</span><br><span class="line">        fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">        fastcgi_index index.php;</span><br><span class="line">        fastcgi_param SCRIPT_FILENAME \<span class="variable">$document_root</span>\<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">        include fastcgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">rm -rf /etc/nginx/conf.d/default.conf </span><br><span class="line">nginx -t</span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure>

<h4 id="下载代码目录"><a href="#下载代码目录" class="headerlink" title="下载代码目录"></a>下载代码目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir /code</span><br><span class="line">scp 10.0.1.51:/data/kodexplorer4.40.zip </span><br><span class="line">unzip kodexplorer4.40.zip -d kod</span><br><span class="line">chown -R nginx:nginx /code/</span><br></pre></td></tr></table></figure>

<h4 id="容器启动脚本命令"><a href="#容器启动脚本命令" class="headerlink" title="容器启动脚本命令"></a>容器启动脚本命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;init.sh&lt;&lt;EOF</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">php-fpm -c /etc/php.ini -y /etc/php-fpm.conf</span><br><span class="line">nginx -g <span class="string">'daemon off;'</span></span><br><span class="line">EOF </span><br><span class="line">chmod +x init.sh</span><br></pre></td></tr></table></figure>

<h4 id="提交新的镜像"><a href="#提交新的镜像" class="headerlink" title="提交新的镜像"></a>提交新的镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit 9e691858a4bd kod:v1</span><br></pre></td></tr></table></figure>

<h4 id="启动测试"><a href="#启动测试" class="headerlink" title="启动测试"></a>启动测试</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker stop $(docker ps -q)</span><br><span class="line">docker rm $(docker ps -aq)</span><br><span class="line">docker run -p 80:80 -v /data/kod/data:/code/kod/data/ -d kod:v1 /bin/bash /root/init.sh</span><br><span class="line">docker ps</span><br></pre></td></tr></table></figure>

<h4 id="访问测试"><a href="#访问测试" class="headerlink" title="访问测试"></a>访问测试</h4><p><img src="/" class="lazyload" data-src="https://note.youdao.com/yws/public/resource/f681b4611780d72ab9718e381df5ea17/7EC73629DAD746768555EB27A63345D7?ynotemdtimestamp=1586417471888"  alt="image"></p>
<h2 id="Dockerfile-自动构建Docker-镜像"><a href="#Dockerfile-自动构建Docker-镜像" class="headerlink" title="Dockerfile 自动构建Docker 镜像"></a>Dockerfile 自动构建Docker 镜像</h2><h3 id="Dockerfile-操作命令说明"><a href="#Dockerfile-操作命令说明" class="headerlink" title="Dockerfile 操作命令说明"></a>Dockerfile 操作命令说明</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">Docker 通过对于在Dockerfile 中的一系列指令的顺序解析实现自动的image 的构建</span><br><span class="line">通过使用build 命令，根据Dockerfiel 的描述来构建镜像</span><br><span class="line">通过源代码路径的方式</span><br><span class="line">通过标准输入流的方式</span><br><span class="line">Dockerfile 指令：</span><br><span class="line">只支持Docker 自己定义的一套指令，不支持自定义</span><br><span class="line">大小写不敏感，但是建议全部使用大写</span><br><span class="line">根据Dockerfile 的内容顺序执行</span><br><span class="line">FROM：</span><br><span class="line">FROM &#123;base 镜像&#125;</span><br><span class="line">必须放在DOckerfile 的第一行，表示从哪个baseimage 开始构建</span><br><span class="line">MAINTAINER：</span><br><span class="line">可选的，用来标识image 作者的地方</span><br><span class="line">RUN：</span><br><span class="line">每一个RUN 指令都会是在一个新的container 里面运行，并提交为一个image 作为下一个RUN 的base</span><br><span class="line">一个Dockerfile 中可以包含多个RUN，按定义顺序执行</span><br><span class="line">RUN 支持两种运行方式：</span><br><span class="line">RUN &lt;cmd&gt; 这个会当作/bin/sh -c “cmd” 运行</span><br><span class="line">RUN [“executable”，“arg1”，。。]，Docker 把他当作json 的顺序来解析，因此必须使用双引号，</span><br><span class="line">而且executable 需要是完整路径</span><br><span class="line">RUN 都是启动一个容器、执行命令、然后提交存储层文件变更。第一层RUN command1 的执行仅仅是当前进程，</span><br><span class="line">一个内存上的变化而已，其结果不会造成任何文件。而到第二层的时候，启动的是一个全新的容器，跟第一层的容</span><br><span class="line">器更完全没关系，自然不可能继承前一层构建过程中的内存变化。而如果需要将两条命令或者多条命令联合起来执</span><br><span class="line">行需要加上&amp;&amp;。如：<span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src &amp;&amp; wget xxxxxxx</span><br><span class="line">CMD：</span><br><span class="line">CMD 的作用是作为执行container 时候的默认行为（容器默认的启动命令）</span><br><span class="line">当运行container 的时候声明了<span class="built_in">command</span>，则不再用image 中的CMD 默认所定义的命令</span><br><span class="line">一个Dockerfile 中只能有一个有效的CMD，当定义多个CMD 的时候，只有最后一个才会起作用</span><br><span class="line">CMD 定义的三种方式：</span><br><span class="line">CMD &lt;cmd&gt; 这个会当作/bin/sh -c <span class="string">"cmd"</span>来执行</span><br><span class="line">CMD [<span class="string">"executable"</span>,<span class="string">"arg1"</span>,....]</span><br><span class="line">CMD [<span class="string">"arg1"</span>,<span class="string">"arg2"</span>]，这个时候CMD 作为ENTRYPOINT 的参数</span><br><span class="line">EXPOSE 声明端口</span><br><span class="line">格式为EXPOSE &lt;端口1&gt; [&lt;端口2&gt;...]。</span><br><span class="line">EXPOSE 指令是声明运行时容器提供服务端口，这只是一个声明，在运行时并不会因为这个声明应用就会开启</span><br><span class="line">这个端口的服务。在Dockerfile 中写入这样的声明有两个好处，一个是帮助镜像使用者理解这个镜像服务的守护</span><br><span class="line">端口，以方便配置映射；另一个用处则是在运行时使用随机端口映射时，也就是docker run -P 时，会自动随机</span><br><span class="line">映射EXPOSE 的端口。</span><br><span class="line">entrypoint：</span><br><span class="line">entrypoint 的作用是，把整个container 变成了一个可执行的文件，这样不能够通过替换CMD 的方法来改变创</span><br><span class="line">建container 的方式。但是可以通过参数传递的方法影响到container 内部</span><br><span class="line">每个Dockerfile 只能够包含一个entrypoint，多个entrypoint 只有最后一个有效</span><br><span class="line">当定义了entrypoint 以后，CMD 只能够作为参数进行传递</span><br><span class="line">entrypoint 定义方式：</span><br><span class="line">entrypoint [<span class="string">"executable"</span>,<span class="string">"arg1"</span>,<span class="string">"arg2"</span>]，这种定义方式下，CMD 可以通过json 的方式来定义entrypoint</span><br><span class="line">的参数，可以通过在运行container 的时候通过指定<span class="built_in">command</span> 的方式传递参数</span><br><span class="line">entrypoint &lt;cmd&gt;，当作/bin/bash -c <span class="string">"cmd"</span>运行命令</span><br><span class="line">ADD &amp; COPY：</span><br><span class="line">当在源代码构建的方式下，可以通过ADD 和COPY 的方式，把host 上的文件或者目录复制到image 中</span><br><span class="line">ADD 和COPY 的源必须在context 路径下</span><br><span class="line">当src 为网络URL 的情况下，ADD 指令可以把它下载到dest 的指定位置，这个在任何build 的方式下都可以</span><br><span class="line">work</span><br><span class="line">ADD 相对COPY 还有一个多的功能，能够进行自动解压压缩包</span><br><span class="line">ENV：</span><br><span class="line">ENV key value</span><br><span class="line">用来设置环境变量，后续的RUN 可以使用它所创建的环境变量</span><br><span class="line">当创建基于该镜像的container 的时候，会自动拥有设置的环境变量</span><br><span class="line">WORKDIR：</span><br><span class="line">用来指定当前工作目录（或者称为当前目录）</span><br><span class="line">当使用相对目录的情况下，采用上一个WORKDIR 指定的目录作为基准</span><br><span class="line">USER：</span><br><span class="line">指定UID 或者username，来决定运行RUN 指令的用户</span><br><span class="line">ONBUILD：</span><br><span class="line">ONBUILD 作为一个trigger 的标记，可以用来trigger 任何Dockerfile 中的指令</span><br><span class="line">可以定义多个ONBUILD 指令</span><br><span class="line">当下一个镜像B 使用镜像A 作为base 的时候，在FROM A 指令前，会先按照顺序执行在构建A 时候定义的ONBUILD指令</span><br><span class="line">ONBUILD &lt;DOCKERFILE 指令&gt; &lt;content&gt;</span><br><span class="line">VOLUME：</span><br><span class="line">用来创建一个在image 之外的mount point，用来在多个container 之间实现数据共享</span><br><span class="line">运行使用json array 的方式定义多个volume</span><br><span class="line">VOLUME [<span class="string">"/var/data1"</span>,<span class="string">"/var/data2"</span>]</span><br><span class="line">或者plain text 的情况下定义多个VOLUME 指令</span><br></pre></td></tr></table></figure>

<h3 id="使用Dockerfile-创建基础系统镜像"><a href="#使用Dockerfile-创建基础系统镜像" class="headerlink" title="使用Dockerfile 创建基础系统镜像"></a>使用Dockerfile 创建基础系统镜像</h3><h3 id="使用Dockerfile-创建云盘"><a href="#使用Dockerfile-创建云盘" class="headerlink" title="使用Dockerfile 创建云盘"></a>使用Dockerfile 创建云盘</h3><h4 id="准备需要的文件"><a href="#准备需要的文件" class="headerlink" title="准备需要的文件"></a>准备需要的文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~/dockerfile/kod]<span class="comment"># ls</span></span><br><span class="line">CentOS-Base.repo cloud.conf dockerfile epel.repo init.sh kodexplorer4.40.zip nginx.repo</span><br></pre></td></tr></table></figure>

<h4 id="编写dockerfile"><a href="#编写dockerfile" class="headerlink" title="编写dockerfile"></a>编写dockerfile</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~/dockerfile/kod]<span class="comment"># cat dockerfile</span></span><br><span class="line">FROM centos:latest</span><br><span class="line">ADD CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo</span><br><span class="line">ADD epel.repo /etc/yum.repos.d/epel.repo</span><br><span class="line">ADD nginx.repo /etc/yum.repos.d/nginx.repo</span><br><span class="line">RUN yum install nginx php-fpm unzip php-gd php-mbstring -y</span><br><span class="line">RUN rm -rf /etc/nginx/conf.d/default.conf</span><br><span class="line">RUN sed -i <span class="string">'/^user/c user = nginx'</span> /etc/php-fpm.d/www.conf</span><br><span class="line">RUN sed -i <span class="string">'/^group/c group = nginx'</span> /etc/php-fpm.d/www.conf</span><br><span class="line">RUN sed -i <span class="string">'/daemonize/s#no#yes#g'</span> /etc/php-fpm.conf</span><br><span class="line">ADD cloud.conf /etc/nginx/conf.d/cloud.conf</span><br><span class="line">RUN mkdir /code</span><br><span class="line">WORKDIR /code</span><br><span class="line">ADD kodexplorer4.40.zip /code/kodexplorer4.40.zip</span><br><span class="line">RUN unzip kodexplorer4.40.zip</span><br><span class="line">RUN chown -R nginx:nginx .</span><br><span class="line">VOLUME /code</span><br><span class="line">ADD init.sh /init.sh</span><br><span class="line">EXPOSE 80</span><br><span class="line">CMD [<span class="string">"/bin/bash"</span>,<span class="string">"/init.sh"</span>]</span><br></pre></td></tr></table></figure>

<h4 id="构建新镜像"><a href="#构建新镜像" class="headerlink" title="构建新镜像"></a>构建新镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~/dockerfile/kod]<span class="comment"># docker build --network=host -t centos_kod:v1 .</span></span><br><span class="line">[root@docker01 ~/dockerfile/kod]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY TAG IMAGE ID CREATED SIZE</span><br><span class="line">centos_kod v1 87071ea7c86b 2 minutes ago 465MB</span><br></pre></td></tr></table></figure>

<h4 id="基于新镜像运行容器"><a href="#基于新镜像运行容器" class="headerlink" title="基于新镜像运行容器"></a>基于新镜像运行容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~/dockerfile/kod]<span class="comment"># docker run -d -p 80:80 centos_kod:v1</span></span><br><span class="line">4d1007d7194d434248762e5aca76070206643f0f0f533f2112d0359b25fe7ba0</span><br></pre></td></tr></table></figure>

<h2 id="Docker-私有仓库"><a href="#Docker-私有仓库" class="headerlink" title="Docker 私有仓库"></a>Docker 私有仓库</h2><h3 id="企业级的docker-harbor"><a href="#企业级的docker-harbor" class="headerlink" title="企业级的docker-harbor"></a>企业级的docker-harbor</h3><h4 id="部署思路"><a href="#部署思路" class="headerlink" title="部署思路"></a>部署思路</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">第一步：安装docker 和docker-compose</span><br><span class="line">第二步：下载harbor-offline-installer-v1.9.0-rc1.tgz</span><br><span class="line">第三步：上传到/opt,并解压</span><br><span class="line">第四步：修改harbor.yml 配置文件hostname = 10.0.0.11 harbor_admin_password = 123456</span><br><span class="line">第五步：执行install.sh</span><br></pre></td></tr></table></figure>

<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>1.下载软件包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">wget https://github.com/goharbor/harbor/releases/download/v1.9.3/harbor-offline-installer-v1.9.3.tgz</span><br><span class="line">tar xf harbor-offline-installer-v1.9.0-rc1.tgz</span><br></pre></td></tr></table></figure>

<p>2.修改配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim harbor.yml </span><br><span class="line">hostname: 10.0.1.5</span><br><span class="line">harbor_admin_password: 123456</span><br></pre></td></tr></table></figure>

<p>3.下载docker-compose</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install docker-compose -y</span><br></pre></td></tr></table></figure>

<p>4.安装harbor</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./install.sh</span><br></pre></td></tr></table></figure>

<p>5.修改镜像名称</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag 019a54813db0 10.0.1.51/linux/centos_kod:v1</span><br></pre></td></tr></table></figure>

<p>6.修改docker配置添加信任仓库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;/etc/docker/daemon.json&lt;&lt;EOF </span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"registry-mirrors"</span>: [<span class="string">"https://1660dchq.mirror.aliyuncs.com"</span>],</span><br><span class="line">  <span class="string">"insecure-registries"</span>: [<span class="string">"http://10.0.1.51"</span>] </span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<p>7.docker登录到harbor</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login 10.0.1.51</span><br></pre></td></tr></table></figure>

<p>8.上传镜像到私有仓库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push 10.0.1.51/linux/centos_kod:v1</span><br></pre></td></tr></table></figure>

<p>9.客户端使用仓库下载镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 8080:80 -d 10.0.1.51/linux/centos_kod:v1</span><br></pre></td></tr></table></figure>

<p>10.访问测试</p>
<p><img src="/" class="lazyload" data-src="https://note.youdao.com/yws/public/resource/f681b4611780d72ab9718e381df5ea17/177D74A8FB504F1DB6D881B13ED113A7?ynotemdtimestamp=1586417471888"  alt="image"></p>
<h2 id="docker运行zabbix"><a href="#docker运行zabbix" class="headerlink" title="docker运行zabbix"></a>docker运行zabbix</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql-server -t \</span><br><span class="line">-e MYSQL_DATABASE=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_USER=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_PASSWORD=<span class="string">"zabbix_pwd"</span> \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=<span class="string">"root_pwd"</span> \</span><br><span class="line">-d mysql:5.7 \</span><br><span class="line">--character-set-server=utf8 --collation-server=utf8_bin</span><br><span class="line"></span><br><span class="line">docker run --name zabbix-server-mysql -t \</span><br><span class="line">-e DB_SERVER_HOST=<span class="string">"mysql-server"</span> \</span><br><span class="line">-e MYSQL_DATABASE=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_USER=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_PASSWORD=<span class="string">"zabbix_pwd"</span> \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=<span class="string">"root_pwd"</span> \</span><br><span class="line">--link mysql-server:mysql \</span><br><span class="line">-p 10051:10051 \</span><br><span class="line">-d zabbix/zabbix-server-mysql:latest</span><br><span class="line"></span><br><span class="line">docker run --name zabbix-web-nginx-mysql -t \</span><br><span class="line">-e DB_SERVER_HOST=<span class="string">"mysql-server"</span> \</span><br><span class="line">-e MYSQL_DATABASE=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_USER=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_PASSWORD=<span class="string">"zabbix_pwd"</span> \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=<span class="string">"root_pwd"</span> \</span><br><span class="line">--link mysql-server:mysql \</span><br><span class="line">--link zabbix-server-mysql:zabbix-server \</span><br><span class="line">-p 80:80 \</span><br><span class="line">-d zabbix/zabbix-web-nginx-mysql:latest</span><br></pre></td></tr></table></figure>

<h2 id="docker运行gitlab"><a href="#docker运行gitlab" class="headerlink" title="docker运行gitlab"></a>docker运行gitlab</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run --detach \</span><br><span class="line">--hostname 10.0.1.51 \</span><br><span class="line">--publish 443:443 --publish 80:80 --publish 22:22 \</span><br><span class="line">--name gitlab \</span><br><span class="line">--restart always \</span><br><span class="line">--volume /srv/gitlab/config:/etc/gitlab \</span><br><span class="line">--volume /srv/gitlab/logs:/var/<span class="built_in">log</span>/gitlab \</span><br><span class="line">--volume /srv/gitlab/data:/var/opt/gitlab \</span><br><span class="line">gitlab/gitlab-ce:latest</span><br></pre></td></tr></table></figure></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Wu Fei</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://linuxwf.com/2020/04/09/Docker%E5%AE%B9%E5%99%A8/">http://linuxwf.com/2020/04/09/Docker%E5%AE%B9%E5%99%A8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://linuxwf.com" target="_blank">WF's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/dokcer/">dokcer</a></div><div class="post_share"><div class="social-share" data-image="/img/wallhaven-106451.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付宝"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/04/09/%E7%AC%AC1%E7%AB%A0-k8s%E7%AE%80%E4%BB%8B/"><img class="prev_cover lazyload" data-src="/img/wallhaven-33397.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">第1章 k8s简介</div></div></a></div><div class="next-post pull_right"><a href="/2020/04/09/Hexo%E6%90%9C%E7%B4%A2%E6%8F%92%E4%BB%B6/"><img class="next_cover lazyload" data-src="/img/65736993_p0.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Hexo搜索插件</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/04/09/第1章-k8s简介/" title="第1章 k8s简介"><img class="relatedPosts_cover lazyload"data-src="/img/wallhaven-33397.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-09</div><div class="relatedPosts_title">第1章 k8s简介</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify: true,
  verify: false,
  appId: 'mJGbzahn0dOntrhO5Hek8Rjd-gzGzoHsz',
  appKey: 'b0O75eIR8ULkl2kyDWLgLXM0',
  placeholder: 'Please leave your footprints',
  avatar: 'monsterid',
  meta: guest_info,
  pageSize: '10',
  lang: 'zh-cn',
  recordIP: false,
  serverURLs: ''
});</script></div></article></main><footer id="footer" style="background-image: url(/img/wallhaven-153272.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By Wu Fei</div><div class="footer_custom_text">Hi, welcome to my <a href="https://www.linuxwf.com/" target="_blank" rel="noopener">blog</a></div><div class="icp"><a href="http://beian.miit.gov.cn" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"/><span>粤ICP备19138449号-1</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode far fa-moon" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/search/algolia.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":100,"vOffset":-50},"mobile":{"show":true,"scale":0.5}});</script></body></html>